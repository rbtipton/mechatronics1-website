<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mechatronics 1: Week 4 - Operational Amplifiers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Academic Blue -->
    <!-- Application Structure Plan: The SPA is structured using a main navigation bar to switch between three core sections: 'Op-Amp Concepts', 'Interactive Sandbox', and 'Practice Problems'. The 'Op-Amp Concepts' section uses a sub-navigation (tabs) for 'Basics', 'Inverting Amp', 'Non-Inverting Amp', 'Summing Amp', and 'Difference Amp'. This architecture organizes the content thematically, allowing students to focus on one concept at a time. The 'Interactive Sandbox' provides a live simulation of a non-inverting amplifier, visualizing input/output and gain. The user flow is designed for progressive learning: grasp a concept, see it applied interactively, explore its behavior visually, and finally, test knowledge with practice problems. This is more engaging and effective than a static document. -->
    <!-- Visualization & Content Choices: Concepts/Steps -> Styled text blocks (HTML/Tailwind). Math Examples -> Interactive step-by-step reveal with a button (JS). Circuit diagrams -> HTML/CSS divs for generic components like op-amp triangle, resistors, wires. Sandbox Visualization -> Bar chart (Chart.js/Canvas) comparing input and output voltages and showing calculated gain. Practice Problems -> Cards with a 'show answer' toggle (JS). This mix of static and interactive content enhances engagement and comprehension. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-active { 
            border-color: #3b82f6; /* blue-500 */
            color: #1d4ed8; /* blue-700 */
            background-color: #eff6ff; /* blue-50 */
        }
        .step-content {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .step-content.visible {
            display: block;
            opacity: 1;
        }
        .solution-box {
            background-color: #f8fafc;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .btn {
            background-color: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
            cursor: pointer;
        }
        .btn:hover { background-color: #2563eb; }
        .btn-secondary {
            background-color: #6b7280;
        }
        .btn-secondary:hover { background-color: #4b5563; }
        .hidden { display: none; }
        .katex-display { display: block; overflow-x: auto; white-space: nowrap; }

        /* Op-Amp Circuit Diagram Styling */
        .opamp-circuit {
            position: relative;
            background-color: #f3f4f6;
            border: 2px solid #d1d5db;
            padding: 1rem;
            border-radius: 0.5rem;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', sans-serif;
            margin-bottom: 1rem;
            box-sizing: border-box;
            overflow: hidden;
        }
        .opamp-symbol {
            position: absolute;
            width: 80px;
            height: 60px;
            clip-path: polygon(0% 0%, 100% 50%, 0% 100%);
            background-color: #3b82f6; /* Blue for op-amp body */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 1;
        }
        .opamp-inverting-input {
            position: absolute;
            width: 10px;
            height: 2px;
            background-color: #374151;
            left: 0;
            top: 20%;
            transform: translateY(-50%);
        }
        .opamp-non-inverting-input {
            position: absolute;
            width: 10px;
            height: 2px;
            background-color: #374151;
            left: 0;
            top: 80%;
            transform: translateY(-50%);
        }
        .opamp-output {
            position: absolute;
            width: 10px;
            height: 2px;
            background-color: #374151;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
        }
        .resistor-line {
            width: 50px;
            height: 2px;
            background-color: #374151;
            position: absolute;
        }
        .resistor-label {
            position: absolute;
            font-size: 0.75rem;
            color: #374151;
            white-space: nowrap;
        }
        .wire-segment {
            position: absolute;
            background-color: #374151;
        }
        .text-label {
            position: absolute;
            font-size: 0.8rem;
            color: #374151;
            white-space: nowrap;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-10">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-bold text-blue-700">Mechatronics 1: Week 4 - Operational Amplifiers</h1>
                <div class="flex space-x-4 text-sm font-medium">
                    <button data-target="concepts" class="nav-link px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">Op-Amp Concepts</button>
                    <button data-target="sandbox" class="nav-link px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">Interactive Sandbox</button>
                    <button data-target="practice" class="nav-link px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">Practice Problems</button>
                </div>
            </div>
        </nav>
    </header>

    <main id="app-container" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Section: Op-Amp Concepts -->
        <section id="concepts" class="app-section">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-3xl font-bold mb-4 text-gray-900">Operational Amplifiers: The Workhorse of Analog Electronics</h2>
                <p class="text-gray-600 mb-6">Operational Amplifiers (Op-Amps) are versatile active circuit elements used in a wide range of applications from signal conditioning to active filters and control systems. This week, we will explore their ideal characteristics and fundamental circuit configurations that form the basis for many mechatronic systems. Select a topic below to learn more.</p>

                <!-- Tabs -->
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex flex-wrap" aria-label="Tabs">
                        <button class="concept-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-concept="op_amp_basics">Basics & Ideal</button>
                        <button class="concept-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-concept="inverting_amp">Inverting Amplifier</button>
                        <button class="concept-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-concept="non_inverting_amp">Non-Inverting Amplifier</button>
                        <button class="concept-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-concept="summing_amp">Summing Amplifier</button>
                        <button class="concept-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-concept="difference_amp">Difference Amplifier</button>
                    </nav>
                </div>

                <!-- Content Area for Concepts -->
                <div id="concept-content" class="mt-6">
                    <!-- Content will be injected here by JS -->
                </div>
            </div>
        </section>

        <!-- Section: Interactive Sandbox -->
        <section id="sandbox" class="app-section hidden">
             <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-3xl font-bold mb-2 text-gray-900">Interactive Sandbox: Non-Inverting Amplifier</h2>
                <p class="text-gray-600 mb-6">Explore the behavior of a non-inverting op-amp configuration. Adjust the input voltage and resistor values to see how the output voltage and gain change. This circuit is commonly used to amplify sensor signals without loading the sensor.</p>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Circuit Parameters</h3>
                        <div class="space-y-4">
                            <div class="flex items-center space-x-2">
                                <label for="vinInput" class="font-medium w-24">Input Voltage ($V_{in}$):</label>
                                <input type="range" id="vinInput" min="-5" max="5" step="0.1" value="1" class="flex-grow">
                                <span id="vinValue" class="font-bold w-16 text-right">1.0 V</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <label for="r1Input" class="font-medium w-24">Resistor R1 (Ω):</label>
                                <input type="range" id="r1Input" min="1000" max="10000" step="100" value="1000" class="flex-grow">
                                <span id="r1Value" class="font-bold w-16 text-right">1000 Ω</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <label for="rfInput" class="font-medium w-24">Resistor Rf (Ω):</label>
                                <input type="range" id="rfInput" min="1000" max="100000" step="1000" value="10000" class="flex-grow">
                                <span id="rfValue" class="font-bold w-16 text-right">10000 Ω</span>
                            </div>
                        </div>
                        <div class="mt-6 text-xl font-bold text-gray-900">
                            Calculated Output: <span id="calculatedOutput">0.00 V</span>
                        </div>
                        <div class="mt-2 text-xl font-bold text-gray-900">
                            Calculated Gain: <span id="calculatedGain">0.00</span>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Voltage & Gain Visualization</h3>
                        <div class="chart-container relative">
                            <canvas id="opAmpSandboxChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: Practice Problems -->
        <section id="practice" class="app-section hidden">
            <div class="bg-white p-6 rounded-lg shadow">
                 <h2 class="text-3xl font-bold mb-4 text-gray-900">Practice Problems</h2>
                 <p class="text-gray-600 mb-6">Test your understanding with these problems from the course notes. Click "Show Answer" to reveal the detailed solution.</p>
                 <div id="practice-problems-container" class="space-y-6">
                    <!-- Practice problems will be injected here -->
                 </div>
                 <h2 class="text-3xl font-bold mt-8 mb-4 text-gray-900">Quiz</h2>
                 <p class="text-gray-600 mb-6">Challenge your knowledge with these multiple-choice questions. Select your answer and click 'Check Answer'.</p>
                 <div id="quiz-container" class="space-y-6">
                    <!-- Quiz questions will be injected here -->
                 </div>
            </div>
        </section>

    </main>
    
<script>
const appData = {
    op_amp_basics: {
        title: "Op-Amp Basics: The Ideal Operational Amplifier",
        description: "An operational amplifier, or op-amp, is a DC-coupled high-gain electronic voltage amplifier with a differential input and, usually, a single-ended output. They are fundamental building blocks in analog circuits due to their versatility when combined with external components.",
        steps: [
            "<strong>Symbol and Terminals:</strong> The op-amp is typically represented by a triangle symbol with two input terminals (inverting '-' and non-inverting '+') and one output terminal. It also requires positive (+Vcc) and negative (-Vee) power supply connections, which are often omitted in simplified diagrams.",
            "<strong>Differential Input:</strong> An op-amp amplifies the difference between the voltages applied to its two input terminals: $V_{out} = A_{OL} (V_+ - V_-)$, where $A_{OL}$ is the open-loop gain.",
            "<strong>Ideal Characteristics:</strong> To simplify analysis and understand their core behavior, we often assume op-amps are 'ideal':",
            "&bull; <strong>Infinite Open-Loop Gain ($A_{OL} \\to \\infty$):</strong> Even a tiny difference in input voltage results in a huge output. This leads to the 'virtual short' concept in negative feedback.",
            "&bull; <strong>Infinite Input Impedance ($Z_{in} \\to \\infty$):</strong> No current flows into the input terminals ($I_+ = I_- = 0$). This means op-amps don't load the source.",
            "&bull; <strong>Zero Output Impedance ($Z_{out} \\to 0$):</strong> The op-amp can supply any load current without its output voltage dropping. It acts as an ideal voltage source.",
            "&bull; <strong>Infinite Bandwidth:</strong> Can amplify any frequency signal without distortion.",
            "&bull; <strong>Zero Input Offset Voltage:</strong> Output is exactly zero when inputs are equal ($V_+ = V_-$).",
            "&bull; <strong>Infinite Slew Rate:</strong> Output voltage can change instantaneously.",
            "Real-Life Application: While no real op-amp is truly ideal, modern op-amps come very close. For instance, in sensitive sensor applications (like reading signals from a strain gauge in a robotic arm), their high input impedance prevents the op-amp from drawing current from the sensor, thus not affecting the sensor's output signal. Their high gain allows for precise amplification of very small signals."
        ],
        example: {
            problem: "Conceptual: How does an ideal op-amp's infinite open-loop gain simplify circuit analysis when negative feedback is used?",
            circuitHTML: ``, 
            solutionSteps: [
                {
                    title: "Concept of Virtual Short",
                    content: `Because $V_{out} = A_{OL} (V_+ - V_-)$ and $A_{OL}$ is practically infinite, for the output voltage to be finite (which it is in linear operation), the differential input voltage $(V_+ - V_-)$ must be practically zero.<br>
                    <div class="solution-box">This implies that $V_+ \\approx V_-$. This condition is known as a 'virtual short' between the input terminals when negative feedback is applied.</div>`
                },
                {
                    title: "Concept of Virtual Ground",
                    content: `If the non-inverting input ($V_+$) is connected to ground (0V), then due to the virtual short, the inverting input ($V_-$) will also be at approximately 0V. This is called a 'virtual ground'.<br>
                    <div class="solution-box">This significantly simplifies applying Kirchhoff's laws at the inverting input node.</div>`
                },
                {
                    title: "Impact on Analysis",
                    content: `These ideal characteristics (especially infinite input impedance and virtual short/ground) allow us to analyze op-amp circuits using simple algebraic equations based on KCL and Ohm's Law, rather than complex differential equations involving the op-amp's internal model. This makes design and troubleshooting much more straightforward.`
                }
            ]
        }
    },
    inverting_amp: {
        title: "Inverting Amplifier",
        description: "The inverting amplifier is one of the most fundamental op-amp configurations. The input signal is applied to the inverting (-) terminal through a resistor ($R_{in}$), and feedback is provided from the output to the inverting input through a feedback resistor ($R_f$). The non-inverting (+) terminal is typically grounded.",
        steps: [
            "Input signal ($V_{in}$) is applied to the inverting terminal via $R_{in}$.",
            "Non-inverting terminal ($V_+$) is connected to ground (0V).",
            "Due to the 'virtual short' property of an ideal op-amp, the inverting terminal ($V_-$) is also at approximately 0V (a 'virtual ground').",
            "Apply KCL at the inverting input node ($V_-$). Since no current enters the op-amp input, the current through $R_{in}$ must flow entirely through $R_f$.",
            "<strong>Gain Formula:</strong> The output voltage is inverted (180° phase shift) and amplified. The gain is set by the ratio of the feedback resistor to the input resistor: $V_{out} = - (R_f / R_{in}) V_{in}$.",
            "Real-Life Application: Commonly used in audio mixing consoles where multiple input signals (e.g., from microphones) need to be summed and amplified before further processing. The inverting configuration also lends itself well to current-to-voltage converters (e.g., for photodiodes) where a small current is converted to a measurable voltage."
        ],
        example: {
            problem: "Design an inverting amplifier with a gain of -10. If the input voltage is 0.5V, what is the output voltage? Use $R_{in} = 10\\text{k}\Omega$.",
            circuitHTML: `<div class="opamp-circuit h-64 w-96 relative">
                            <div class="opamp-symbol" style="left: 30%; top: 50%; transform: translate(-50%, -50%);"></div>
                            <div class="opamp-inverting-input" style="left: 10%; top: 20%; width: 20px;"></div>
                            <div class="opamp-non-inverting-input" style="left: 10%; top: 80%; width: 20px;"></div>
                            <div class="opamp-output" style="left: 70%; top: 50%; width: 20px;"></div>

                            <div class="text-label" style="left: 0%; top: 20%; transform: translateY(-50%);">Vin</div>
                            <div class="text-label" style="left: 75%; top: 50%; transform: translateY(-50%);">Vout</div>
                            <div class="text-label" style="left: 10%; bottom: 10%;">GND</div>
                            <div class="text-label" style="left: 20%; top: 0%; font-size: 0.6rem;">+Vcc</div>
                            <div class="text-label" style="left: 20%; bottom: 0%; font-size: 0.6rem;">-Vee</div>


                            <!-- Wires for Op-Amp -->
                            <div class="wire-segment" style="left: 28%; top: 20%; width: 2px; height: 10px;"></div>
                            <div class="wire-segment" style="left: 28%; top: 80%; width: 2px; height: 10px;"></div>
                            <div class="wire-segment" style="left: 70%; top: 50%; width: 10px; height: 2px;"></div>

                            <!-- Resistor Rin -->
                            <div class="resistor-line" style="left: 10%; top: 20%; transform: rotate(0deg); width: 20px;"></div>
                            <div class="resistor-label" style="left: 15%; top: 10%;">Rin</div>

                            <!-- Resistor Rf (Feedback) -->
                            <div class="resistor-line" style="left: 70%; top: 20%; width: 30px; transform: rotate(0deg); transform-origin: left; top: 20%; left: 70%; width: 0; height: 2px;"></div>
                            <div class="wire-segment" style="left: 65%; top: 20%; width: 2px; height: 30%;"></div>
                            <div class="wire-segment" style="left: 70%; top: 20%; width: 0; height: 2px;"></div>
                            <div class="wire-segment" style="left: 65%; top: 50%; width: 5px; height: 2px;"></div>

                            <div class="resistor-line" style="left: 45%; top: 20%; width: 20px;"></div>
                            <div class="resistor-label" style="left: 50%; top: 10%;">Rf</div>
                            <div class="wire-segment" style="left: 65%; top: 20%; height: 2px; width: 5px;"></div>
                            <div class="wire-segment" style="left: 65%; top: 20%; width: 2px; height: 30%;"></div>
                            <div class="wire-segment" style="left: 65%; top: 50%; width: 5px; height: 2px;"></div>

                        </div>`,
            solutionSteps: [
                {
                    title: "Step 1: Determine Feedback Resistor ($R_f$)",
                    content: `The gain formula is $A_v = -R_f / R_{in}$. We need a gain of -10, and $R_{in} = 10\\text{k}\\Omega$.<br>
                    <div class="solution-box"> $-10 = -R_f / 10\\text{k}\\Omega \\implies R_f = 10 \\cdot 10\\text{k}\\Omega = 100\\text{k}\\Omega$ </div>`
                },
                {
                    title: "Step 2: Calculate Output Voltage",
                    content: `Using the gain formula with $V_{in} = 0.5\\text{V}$.<br>
                    <div class="solution-box"> $V_{out} = - (R_f / R_{in}) V_{in} = - (100\\text{k}\\Omega / 10\\text{k}\\Omega) \\cdot 0.5\\text{V} = -10 \\cdot 0.5\\text{V} = -5\\text{V}$ </div>`
                },
                {
                    title: "Final Answer",
                    content: `<div class="p-4 bg-green-100 text-green-800 rounded-lg">To achieve a gain of -10, use $R_f = <strong>100\\text{k}\\Omega</strong>$. <br> With $V_{in} = 0.5\\text{V}$, the output is $V_{out} = <strong>-5\\text{V}</strong>$. </div>`
                }
            ]
        }
    },
    non_inverting_amp: {
        title: "Non-Inverting Amplifier",
        description: "The non-inverting amplifier configuration provides an output voltage that is in phase with the input voltage. The input signal is applied directly to the non-inverting (+) terminal, and a portion of the output is fed back to the inverting (-) terminal via a voltage divider.",
        steps: [
            "Input signal ($V_{in}$) is applied directly to the non-inverting terminal ($V_+$).",
            "A voltage divider (consisting of $R_1$ and $R_f$) feeds a fraction of the output voltage back to the inverting terminal ($V_-$).",
            "Due to the 'virtual short' property, the voltage at the inverting terminal ($V_-$) is equal to the voltage at the non-inverting terminal ($V_+$), which is $V_{in}$.",
            "Apply the voltage divider rule to the feedback network to relate $V_-$ to $V_{out}$.",
            "<strong>Gain Formula:</strong> The output voltage is non-inverted and amplified. The gain is $V_{out} = (1 + R_f / R_1) V_{in}$.",
            "Real-Life Application: Commonly used as a buffer amplifier (when $R_f=0$ and $R_1=\\infty$, resulting in unity gain), which is essential for isolating high-impedance sources (like some sensors) from low-impedance loads (like microcontrollers), preventing signal degradation. It's also widely used for general signal amplification where a non-inverted output is desired."
        ],
        example: {
            problem: "A non-inverting amplifier has $R_1 = 2\\text{k}\Omega$ and $R_f = 18\\text{k}\Omega$. If $V_{in} = 0.8\\text{V}$, what is the output voltage and gain?",
            circuitHTML: `<div class="opamp-circuit h-64 w-96 relative">
                            <div class="opamp-symbol" style="left: 30%; top: 50%; transform: translate(-50%, -50%);"></div>
                            <div class="opamp-inverting-input" style="left: 10%; top: 20%; width: 20px;"></div>
                            <div class="opamp-non-inverting-input" style="left: 10%; top: 80%; width: 20px;"></div>
                            <div class="opamp-output" style="left: 70%; top: 50%; width: 20px;"></div>

                            <div class="text-label" style="left: 0%; top: 80%; transform: translateY(-50%);">Vin</div>
                            <div class="text-label" style="left: 75%; top: 50%; transform: translateY(-50%);">Vout</div>
                            <div class="text-label" style="left: 20%; top: 0%; font-size: 0.6rem;">+Vcc</div>
                            <div class="text-label" style="left: 20%; bottom: 0%; font-size: 0.6rem;">-Vee</div>

                            <!-- Wires for Op-Amp -->
                            <div class="wire-segment" style="left: 28%; top: 20%; width: 2px; height: 10px;"></div>
                            <div class="wire-segment" style="left: 28%; top: 80%; width: 2px; height: 10px;"></div>
                            <div class="wire-segment" style="left: 70%; top: 50%; width: 10px; height: 2px;"></div>

                            <!-- Resistor R1 -->
                            <div class="resistor-line" style="left: 10%; bottom: 20%; width: 20px;"></div>
                            <div class="resistor-label" style="left: 15%; bottom: 10%;">R1</div>
                            <div class="wire-segment" style="left: 28%; top: 20%; width: 2px; height: 50%;"></div>
                            <div class="wire-segment" style="left: 28%; bottom: 20%; width: 2px; height: 5px;"></div>
                            <div class="wire-segment" style="left: 10%; bottom: 20%; width: 18px; height: 2px;"></div>

                            <!-- Resistor Rf (Feedback) -->
                            <div class="resistor-line" style="left: 45%; top: 20%; width: 20px;"></div>
                            <div class="resistor-label" style="left: 50%; top: 10%;">Rf</div>
                            <div class="wire-segment" style="left: 65%; top: 20%; height: 2px; width: 5px;"></div>
                            <div class="wire-segment" style="left: 65%; top: 20%; width: 2px; height: 30%;"></div>
                            <div class="wire-segment" style="left: 65%; top: 50%; width: 5px; height: 2px;"></div>

                        </div>`,
            solutionSteps: [
                {
                    title: "Step 1: Calculate the Gain ($A_v$)",
                    content: `The gain formula for a non-inverting amplifier is $A_v = 1 + R_f / R_1$.<br>
                    <div class="solution-box"> $A_v = 1 + 18\\text{k}\\Omega / 2\\text{k}\\Omega = 1 + 9 = 10$ </div>`
                },
                {
                    title: "Step 2: Calculate Output Voltage ($V_{out}$)",
                    content: `Using the calculated gain and $V_{in} = 0.8\\text{V}$.<br>
                    <div class="solution-box"> $V_{out} = A_v \\cdot V_{in} = 10 \\cdot 0.8\\text{V} = 8\\text{V}$ </div>`
                },
                {
                    title: "Final Answer",
                    content: `<div class="p-4 bg-green-100 text-green-800 rounded-lg">The gain of the amplifier is <strong>10</strong>. <br> With $V_{in} = 0.8\\text{V}$, the output is $V_{out} = <strong>8\\text{V}</strong>$. </div>`
                }
            ]
        }
    },
    summing_amp: {
        title: "Summing Amplifier",
        description: "A summing amplifier (or adder) is an extension of the inverting amplifier that combines multiple input signals into a single output. It's often used to create a weighted sum of several voltages.",
        steps: [
            "Multiple input resistors ($R_1, R_2, ..., R_n$) are connected to the inverting terminal.",
            "The non-inverting terminal is grounded (virtual ground at inverting terminal).",
            "A feedback resistor ($R_f$) connects the output to the inverting terminal.",
            "Apply KCL at the inverting input node. The sum of currents from input resistors equals the current through the feedback resistor.",
            "<strong>Output Formula:</strong> $V_{out} = -R_f (V_1/R_1 + V_2/R_2 + ... + V_n/R_n)$. If all input resistors are equal ($R_1 = R_2 = ... = R_{in}$), then $V_{out} = - (R_f / R_{in}) (V_1 + V_2 + ... + V_n)$.",
            "Real-Life Application: Audio mixing consoles use summing amplifiers to combine signals from multiple microphones or instruments into a single output channel. In control systems, it can be used to sum error signals or combine different sensor readings."
        ],
        example: {
            problem: "An inverting summing amplifier has $R_f = 10\\text{k}\\Omega$, $R_1 = 5\\text{k}\\Omega$, $R_2 = 10\\text{k}\\Omega$. If $V_1 = 1\\text{V}$ and $V_2 = 2\\text{V}$, find the output voltage.",
            circuitHTML: `<div class="opamp-circuit h-64 w-96 relative">
                            <div class="opamp-symbol" style="left: 30%; top: 50%; transform: translate(-50%, -50%);"></div>
                            <div class="opamp-inverting-input" style="left: 10%; top: 20%; width: 20px;"></div>
                            <div class="opamp-non-inverting-input" style="left: 10%; top: 80%; width: 20px;"></div>
                            <div class="opamp-output" style="left: 70%; top: 50%; width: 20px;"></div>

                            <div class="text-label" style="left: 0%; top: 10%; transform: translateY(-50%);">V1</div>
                            <div class="text-label" style="left: 0%; top: 30%; transform: translateY(-50%);">V2</div>
                            <div class="text-label" style="left: 75%; top: 50%; transform: translateY(-50%);">Vout</div>
                            <div class="text-label" style="left: 10%; bottom: 10%;">GND</div>
                            <div class="text-label" style="left: 20%; top: 0%; font-size: 0.6rem;">+Vcc</div>
                            <div class="text-label" style="left: 20%; bottom: 0%; font-size: 0.6rem;">-Vee</div>

                            <!-- Wires for Op-Amp -->
                            <div class="wire-segment" style="left: 28%; top: 20%; width: 2px; height: 10px;"></div>
                            <div class="wire-segment" style="left: 28%; top: 80%; width: 2px; height: 10px;"></div>
                            <div class="wire-segment" style="left: 70%; top: 50%; width: 10px; height: 2px;"></div>

                            <!-- Resistor R1 -->
                            <div class="resistor-line" style="left: 10%; top: 10%; width: 20px;"></div>
                            <div class="resistor-label" style="left: 15%; top: 0%;">R1</div>
                            <div class="wire-segment" style="left: 28%; top: 10%; width: 2px; height: 10%;"></div>

                            <!-- Resistor R2 -->
                            <div class="resistor-line" style="left: 10%; top: 30%; width: 20px;"></div>
                            <div class="resistor-label" style="left: 15%; top: 20%;">R2</div>
                            <div class="wire-segment" style="left: 28%; top: 30%; width: 2px; height: -10%;"></div>

                            <!-- Feedback Resistor Rf -->
                            <div class="resistor-line" style="left: 45%; top: 20%; width: 20px;"></div>
                            <div class="resistor-label" style="left: 50%; top: 10%;">Rf</div>
                            <div class="wire-segment" style="left: 65%; top: 20%; height: 2px; width: 5px;"></div>
                            <div class="wire-segment" style="left: 65%; top: 20%; width: 2px; height: 30%;"></div>
                            <div class="wire-segment" style="left: 65%; top: 50%; width: 5px; height: 2px;"></div>

                        </div>`,
            solutionSteps: [
                {
                    title: "Step 1: Apply KCL at the Inverting Input (Virtual Ground)",
                    content: `Since the non-inverting input is grounded, the inverting input is also at 0V. The sum of currents entering the inverting node is zero.<br>
                    Current from $V_1$: $I_1 = (V_1 - 0) / R_1 = V_1 / R_1$<br>
                    Current from $V_2$: $I_2 = (V_2 - 0) / R_2 = V_2 / R_2$<br>
                    Current through $R_f$: $I_f = (0 - V_{out}) / R_f = -V_{out} / R_f$<br>
                    <div class="solution-box"> $I_1 + I_2 + I_f = 0 \\implies V_1/R_1 + V_2/R_2 - V_{out}/R_f = 0$ </div>`
                },
                {
                    title: "Step 2: Solve for $V_{out}$",
                    content: `Rearrange the KCL equation to solve for $V_{out}$.<br>
                    $V_{out}/R_f = V_1/R_1 + V_2/R_2$<br>
                    <div class="solution-box"> $V_{out} = -R_f (V_1/R_1 + V_2/R_2)$ </div>`
                },
                {
                    title: "Step 3: Substitute Values",
                    content: `Substitute the given values: $R_f = 10\\text{k}\\Omega$, $R_1 = 5\\text{k}\\Omega$, $R_2 = 10\\text{k}\\Omega$, $V_1 = 1\\text{V}$, $V_2 = 2\\text{V}$.<br>
                    <div class="solution-box"> $V_{out} = -10\\text{k}\\Omega (1\\text{V}/5\\text{k}\\Omega + 2\\text{V}/10\\text{k}\\Omega)$ <br> $V_{out} = -10\\text{k}\\Omega (0.2 \\times 10^{-3} + 0.2 \\times 10^{-3})$ <br> $V_{out} = -10\\text{k}\\Omega (0.4 \\times 10^{-3}) = -4\\text{V}$ </div>`
                },
                {
                    title: "Final Answer",
                    content: `<div class="p-4 bg-green-100 text-green-800 rounded-lg">The output voltage is $V_{out} = <strong>-4\\text{V}</strong>$. </div>`
                }
            ]
        }
    },
    difference_amp: {
        title: "Difference Amplifier",
        description: "A difference amplifier (or subtractor) amplifies the difference between two input voltages. It is a key component in many measurement systems, particularly where noise is present, as it can reject common-mode signals.",
        steps: [
            "Input $V_1$ is applied to the inverting terminal ($V_-$) via $R_1$, with feedback resistor $R_f$ from output to $V_-$.",
            "Input $V_2$ is applied to the non-inverting terminal ($V_+$) via $R_2$, with resistor $R_g$ from $V_+$ to ground.",
            "Analyze the circuit using the superposition principle or by applying KCL at both input nodes considering the virtual short ($V_+ = V_-$).",
            "<strong>Output Formula (if $R_1 = R_2$ and $R_f = R_g$):</strong> $V_{out} = (R_f / R_1) (V_2 - V_1)$. If all four resistors are equal ($R_1 = R_2 = R_f = R_g = R$), then $V_{out} = V_2 - V_1$ (unity gain difference).",
            "Real-Life Application: The core of an instrumentation amplifier, which is used to amplify very small differential signals from sensors (like a Wheatstone bridge in a load cell or pressure sensor) while rejecting large common-mode noise (e.g., from power lines). This is crucial for precise measurements in industrial automation and medical devices."
        ],
        example: {
            problem: "A difference amplifier has $R_1 = R_2 = 5\\text{k}\\Omega$ and $R_f = R_g = 15\\text{k}\\Omega$. If $V_1 = 2\\text{V}$ and $V_2 = 4\\text{V}$, what is the output voltage?",
            circuitHTML: `<div class="opamp-circuit h-64 w-96 relative">
                            <div class="opamp-symbol" style="left: 30%; top: 50%; transform: translate(-50%, -50%);"></div>
                            <div class="opamp-inverting-input" style="left: 10%; top: 20%; width: 20px;"></div>
                            <div class="opamp-non-inverting-input" style="left: 10%; top: 80%; width: 20px;"></div>
                            <div class="opamp-output" style="left: 70%; top: 50%; width: 20px;"></div>

                            <div class="text-label" style="left: 0%; top: 20%; transform: translateY(-50%);">V1</div>
                            <div class="text-label" style="left: 0%; top: 80%; transform: translateY(-50%);">V2</div>
                            <div class="text-label" style="left: 75%; top: 50%; transform: translateY(-50%);">Vout</div>
                            <div class="text-label" style="left: 20%; top: 0%; font-size: 0.6rem;">+Vcc</div>
                            <div class="text-label" style="left: 20%; bottom: 0%; font-size: 0.6rem;">-Vee</div>

                            <!-- Wires for Op-Amp -->
                            <div class="wire-segment" style="left: 28%; top: 20%; width: 2px; height: 10px;"></div>
                            <div class="wire-segment" style="left: 28%; top: 80%; width: 2px; height: 10px;"></div>
                            <div class="wire-segment" style="left: 70%; top: 50%; width: 10px; height: 2px;"></div>

                            <!-- Resistor R1 -->
                            <div class="resistor-line" style="left: 10%; top: 20%; width: 20px;"></div>
                            <div class="resistor-label" style="left: 15%; top: 10%;">R1</div>

                            <!-- Resistor Rf (Feedback) -->
                            <div class="resistor-line" style="left: 45%; top: 20%; width: 20px;"></div>
                            <div class="resistor-label" style="left: 50%; top: 10%;">Rf</div>
                            <div class="wire-segment" style="left: 65%; top: 20%; height: 2px; width: 5px;"></div>
                            <div class="wire-segment" style="left: 65%; top: 20%; width: 2px; height: 30%;"></div>
                            <div class="wire-segment" style="left: 65%; top: 50%; width: 5px; height: 2px;"></div>

                            <!-- Resistor R2 -->
                            <div class="resistor-line" style="left: 10%; top: 80%; width: 20px;"></div>
                            <div class="resistor-label" style="left: 15%; top: 70%;">R2</div>

                            <!-- Resistor Rg -->
                            <div class="resistor-line" style="left: 45%; top: 80%; width: 20px;"></div>
                            <div class="resistor-label" style="left: 50%; top: 70%;">Rg</div>
                            <div class="wire-segment" style="left: 65%; top: 80%; height: 2px; width: 5px;"></div>
                            <div class="wire-segment" style="left: 65%; bottom: 10%; width: 2px; height: 10%;"></div>
                            <div class="wire-segment" style="left: 65%; bottom: 10%; height: 2px; width: 5px;"></div>
                            <div class="text-label" style="left: 70%; bottom: 10%;">GND</div>
                        </div>`,
            solutionSteps: [
                {
                    title: "Step 1: Apply KCL at Inverting Input ($V_-$)",
                    content: `Due to the virtual short, $V_- = V_+$. First find $V_+$ using the voltage divider rule for $V_2$ and $R_2, R_g$: <br>
                    $V_+ = V_2 \\cdot (R_g / (R_2 + R_g))$ (assuming $R_g$ is connected to ground, which is standard).<br>
                    If $R_1=R_2$ and $R_f=R_g$, the output formula simplifies.
                    For this case, $V_{out} = (R_f / R_1) (V_2 - V_1)$.`
                },
                {
                    title: "Step 2: Calculate Gain and Output",
                    content: `Given $R_1 = R_2 = 5\\text{k}\\Omega$ and $R_f = R_g = 15\\text{k}\\Omega$.<br>
                    Gain $A = R_f / R_1 = 15\\text{k}\\Omega / 5\\text{k}\\Omega = 3$.<br>
                    <div class="solution-box"> $V_{out} = A \\cdot (V_2 - V_1) = 3 \\cdot (4\\text{V} - 2\\text{V}) = 3 \\cdot 2\\text{V} = 6\\text{V}$ </div>`
                },
                {
                    title: "Final Answer",
                    content: `<div class="p-4 bg-green-100 text-green-800 rounded-lg">The output voltage is $V_{out} = <strong>6\\text{V}</strong>$. </div>`
                }
            ]
        }
    }
};

const practiceProblems = [
    {
        id: 1,
        title: "Inverting Amplifier Design",
        problemHTML: `Design an inverting amplifier to have a gain of -20. If $R_{in} = 5\\text{k}\\Omega$, what value of $R_f$ is needed? If $V_{in} = 0.25\\text{V}$, what is the output voltage?`,
        answerHTML: `<b>Solution:</b><br>
        1. Gain $A_v = -R_f / R_{in}$. So, $-20 = -R_f / 5\\text{k}\\Omega \\implies R_f = 20 \\cdot 5\\text{k}\\Omega = 100\\text{k}\\Omega$.<br>
        2. $V_{out} = A_v \\cdot V_{in} = -20 \\cdot 0.25\\text{V} = -5\\text{V}$.<br>
        <div class="solution-box"> $R_f = 100\\text{k}\\Omega$, $V_{out} = -5\\text{V}$ </div>`
    },
    {
        id: 2,
        title: "Non-Inverting Amplifier Calculation",
        problemHTML: `A non-inverting amplifier has $R_1 = 3.3\\text{k}\\Omega$ and $R_f = 33\\text{k}\\Omega$. If the input signal is $V_{in} = 1.2\\text{V}$, calculate the gain and the output voltage.`,
        answerHTML: `<b>Solution:</b><br>
        1. Gain $A_v = 1 + R_f / R_1 = 1 + 33\\text{k}\\Omega / 3.3\\text{k}\\Omega = 1 + 10 = 11$.<br>
        2. $V_{out} = A_v \\cdot V_{in} = 11 \\cdot 1.2\\text{V} = 13.2\\text{V}$.<br>
        <div class="solution-box"> Gain = 11, $V_{out} = 13.2\\text{V}$ </div>`
    },
    {
        id: 3,
        title: "Summing Amplifier Application",
        problemHTML: `An inverting summing amplifier has $R_f = 20\\text{k}\\Omega$, and two inputs with $R_1 = 10\\text{k}\\Omega$ and $R_2 = 5\\text{k}\\Omega$. If $V_1 = 0.5\\text{V}$ and $V_2 = 1.0\\text{V}$, what is the output voltage?`,
        answerHTML: `<b>Solution:</b><br>
        $V_{out} = -R_f (V_1/R_1 + V_2/R_2)$<br>
        $V_{out} = -20\\text{k}\\Omega (0.5\\text{V}/10\\text{k}\\Omega + 1.0\\text{V}/5\\text{k}\\Omega)$<br>
        $V_{out} = -20\\text{k}\\Omega (0.05\\text{mA} + 0.2\\text{mA})$<br>
        $V_{out} = -20\\text{k}\\Omega (0.25\\text{mA}) = -5\\text{V}$.<br>
        <div class="solution-box"> $V_{out} = -5\\text{V}$ </div>`
    },
    {
        id: 4,
        title: "Difference Amplifier Analysis",
        problemHTML: `A difference amplifier has $R_1 = 10\\text{k}\\Omega$, $R_2 = 10\\text{k}\\Omega$, $R_f = 50\\text{k}\\Omega$, and $R_g = 50\\text{k}\\Omega$. If $V_1 = 3\\text{V}$ and $V_2 = 5\\text{V}$, calculate the output voltage.`,
        answerHTML: `<b>Solution:</b><br>
        Since $R_1 = R_2$ and $R_f = R_g$, the formula is $V_{out} = (R_f / R_1) (V_2 - V_1)$.<br>
        Gain $A = R_f / R_1 = 50\\text{k}\\Omega / 10\\text{k}\\Omega = 5$.<br>
        $V_{out} = 5 \\cdot (5\\text{V} - 3\\text{V}) = 5 \\cdot 2\\text{V} = 10\\text{V}$.<br>
        <div class="solution-box"> $V_{out} = 10\\text{V}$ </div>`
    }
];

const quizQuestions = [
    {
        id: 1,
        question: "What is an ideal op-amp's input impedance?",
        options: ["Zero", "Very low", "Infinite", "Depends on feedback"],
        answer: "Infinite",
        explanation: "An ideal op-amp has infinite input impedance, meaning no current flows into its input terminals."
    },
    {
        id: 2,
        question: "In an inverting amplifier, if the non-inverting input is grounded, what is the voltage at the inverting input?",
        options: ["Equal to output voltage", "Equal to input voltage", "Approximately zero (virtual ground)", "Half the supply voltage"],
        answer: "Approximately zero (virtual ground)",
        explanation: "Due to the virtual short concept in negative feedback, the inverting input tracks the non-inverting input, creating a virtual ground if the non-inverting input is grounded."
    },
    {
        id: 3,
        question: "Which op-amp configuration is best suited for combining multiple analog signals into a single output?",
        options: ["Non-Inverting Amplifier", "Difference Amplifier", "Voltage Follower", "Summing Amplifier"],
        answer: "Summing Amplifier",
        explanation: "The summing amplifier is designed to combine and scale multiple input voltages."
    },
    {
        id: 4,
        question: "The gain of a non-inverting amplifier is given by:",
        options: ["$-R_f / R_{in}$", "$1 + (R_f / R_1)$", "$R_f / R_1$", "$V_{out} / V_{in}$"],
        answer: "$1 + (R_f / R_1)$",
        explanation: "The gain of a non-inverting amplifier is always greater than or equal to 1, given by $1 + (R_f / R_1)$."
    },
    {
        id: 5,
        question: "What real-life application commonly uses a difference amplifier (or instrumentation amplifier based on it) to reject common-mode noise?",
        options: ["Audio amplifier for headphones", "LED driver circuit", "Sensor signal conditioning (e.g., from a Wheatstone bridge)", "Simple battery charger"],
        answer: "Sensor signal conditioning (e.g., from a Wheatstone bridge)",
        explanation: "Difference amplifiers excel at amplifying the small difference between two noisy inputs, effectively rejecting common-mode noise, which is common in sensor applications."
    }
];


document.addEventListener('DOMContentLoaded', () => {
    const navLinks = document.querySelectorAll('.nav-link');
    const appSections = document.querySelectorAll('.app-section');
    const conceptTabs = document.querySelectorAll('.concept-tab');
    const conceptContentContainer = document.getElementById('concept-content');
    
    // Main navigation
    navLinks.forEach(link => {
        link.addEventListener('click', () => {
            const targetId = link.dataset.target;
            appSections.forEach(section => {
                section.classList.toggle('hidden', section.id !== targetId);
            });
            navLinks.forEach(l => l.classList.remove('font-bold', 'text-blue-600'));
            link.classList.add('font-bold', 'text-blue-600');
        });
    });

    // Concept tabs
    conceptTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const conceptId = tab.dataset.concept;
            conceptTabs.forEach(t => t.classList.remove('tab-active', 'border-blue-500', 'text-blue-600'));
            tab.classList.add('tab-active', 'border-blue-500', 'text-blue-600');
            renderConcept(conceptId);
        });
    });

    function renderConcept(conceptId) {
        const data = appData[conceptId];
        if (!data) return;

        let stepsHTML = data.steps.map(step => `<li class="mb-2">${step}</li>`).join('');
        let exampleStepsHTML = data.example.solutionSteps.map((step, index) => `
            <div id="step-${index}" class="step-content border-t pt-4 mt-4">
                <h4 class="font-semibold text-lg text-blue-700">${step.title}</h4>
                <div class="text-gray-700 mt-2">${step.content}</div>
            </div>
        `).join('');

        conceptContentContainer.innerHTML = `
            <h3 class="text-2xl font-bold text-gray-800">${data.title}</h3>
            <p class="mt-2 mb-4 text-gray-600">${data.description}</p>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h4 class="text-xl font-semibold mb-2">Key Concepts & Real-Life Application</h4>
                    <ul class="list-decimal list-inside text-gray-700 space-y-1">${stepsHTML}</ul>
                </div>
                <div>
                    <h4 class="text-xl font-semibold mb-2">Interactive Example: ${data.example.problem}</h4>
                    ${data.example.circuitHTML || ''}
                    <div id="example-steps-container">${exampleStepsHTML}</div>
                    <div class="mt-4 flex space-x-2">
                         <button id="next-step-btn" class="btn">Start</button>
                         <button id="reset-steps-btn" class="btn btn-secondary">Reset</button>
                    </div>
                </div>
            </div>`;
        
        setupInteractiveExample();
    }
    
    let currentStep = -1;
    function setupInteractiveExample() {
        const nextBtn = document.getElementById('next-step-btn');
        const resetBtn = document.getElementById('reset-steps-btn');
        const steps = document.querySelectorAll('.step-content');
        currentStep = -1;

        const showNextStep = () => {
            if (currentStep >= 0) {
                steps[currentStep].classList.remove('visible');
            }
            currentStep++;
            if (currentStep < steps.length) {
                steps[currentStep].classList.add('visible');
                nextBtn.textContent = 'Next Step';
            }
            if (currentStep >= steps.length - 1) {
                nextBtn.disabled = true;
                nextBtn.textContent = 'Finished';
            }
        };

        const resetSteps = () => {
            steps.forEach(step => step.classList.remove('visible'));
            currentStep = -1;
            nextBtn.disabled = false;
            nextBtn.textContent = 'Start';
        };

        nextBtn.addEventListener('click', showNextStep);
        resetBtn.addEventListener('click', resetSteps);
    }
    
    function renderPracticeProblems() {
        const container = document.getElementById('practice-problems-container');
        container.innerHTML = practiceProblems.map(p => `
            <div class="border rounded-lg p-4">
                <h4 class="text-lg font-semibold">${p.title}</h4>
                <p class="mt-2 text-gray-700">${p.problemHTML}</p>
                <div id="answer-${p.id}" class="mt-4 p-4 bg-blue-50 rounded hidden">
                   ${p.answerHTML}
                </div>
                <button data-answer-id="${p.id}" class="toggle-answer-btn btn mt-4 text-sm">Show Answer</button>
            </div>
        `).join('');

        document.querySelectorAll('.toggle-answer-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const answerId = btn.dataset.answerId;
                const answerEl = document.getElementById(`answer-${answerId}`);
                answerEl.classList.toggle('hidden');
                btn.textContent = answerEl.classList.contains('hidden') ? 'Show Answer' : 'Hide Answer';
            });
        });
    }

    function renderQuiz() {
        const container = document.getElementById('quiz-container');
        container.innerHTML = quizQuestions.map((q, index) => `
            <div class="border rounded-lg p-4">
                <h4 class="text-lg font-semibold mb-3">Q${index + 1}: ${q.question}</h4>
                <div class="space-y-2">
                    ${q.options.map((option, optIndex) => `
                        <label class="block">
                            <input type="radio" name="quiz-q${q.id}" value="${option}" class="mr-2">
                            ${option}
                        </label>
                    `).join('')}
                </div>
                <button data-question-id="${q.id}" class="check-quiz-btn btn mt-4 text-sm">Check Answer</button>
                <div id="quiz-feedback-${q.id}" class="mt-3 text-sm font-semibold"></div>
            </div>
        `).join('');

        document.querySelectorAll('.check-quiz-btn').forEach(btn => {
            btn.addEventListener('click', (event) => {
                const questionId = btn.dataset.questionId;
                const selectedOption = document.querySelector(`input[name="quiz-q${questionId}"]:checked`);
                const feedbackEl = document.getElementById(`quiz-feedback-${questionId}`);
                const question = quizQuestions.find(q => q.id == questionId);

                if (!selectedOption) {
                    feedbackEl.innerHTML = `<span class="text-yellow-600">Please select an option.</span>`;
                    return;
                }

                if (selectedOption.value === question.answer) {
                    feedbackEl.innerHTML = `<span class="text-green-600">Correct!</span> ${question.explanation}`;
                } else {
                    feedbackEl.innerHTML = `<span class="text-red-600">Incorrect.</span> The correct answer is: <strong>${question.answer}</strong>. ${question.explanation}`;
                }
            });
        });
    }

    // Sandbox logic for Non-Inverting Amplifier
    const vinInput = document.getElementById('vinInput');
    const r1Input = document.getElementById('r1Input');
    const rfInput = document.getElementById('rfInput');
    const vinValueSpan = document.getElementById('vinValue');
    const r1ValueSpan = document.getElementById('r1Value');
    const rfValueSpan = document.getElementById('rfValue');
    const calculatedOutputSpan = document.getElementById('calculatedOutput');
    const calculatedGainSpan = document.getElementById('calculatedGain');
    const opAmpSandboxChartCtx = document.getElementById('opAmpSandboxChart').getContext('2d');
    let opAmpChart;

    function updateSandbox() {
        const vin = parseFloat(vinInput.value);
        const r1 = parseFloat(r1Input.value);
        const rf = parseFloat(rfInput.value);

        vinValueSpan.textContent = `${vin.toFixed(1)} V`;
        r1ValueSpan.textContent = `${r1} Ω`;
        rfValueSpan.textContent = `${rf} Ω`;

        const gain = 1 + (rf / r1);
        const vout = vin * gain;

        calculatedOutputSpan.textContent = `${vout.toFixed(2)} V`;
        calculatedGainSpan.textContent = `${gain.toFixed(2)}`;

        if (!opAmpChart) {
            opAmpChart = new Chart(opAmpSandboxChartCtx, {
                type: 'bar',
                data: {
                    labels: ['Input Voltage ($V_{in}$)', 'Output Voltage ($V_{out}$)'],
                    datasets: [{
                        label: 'Voltage (V)',
                        data: [vin, vout],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.6)', // Blue for input
                            'rgba(34, 197, 94, 0.6)'    // Green for output
                        ],
                        borderColor: [
                            'rgba(59, 130, 246, 1)',
                            'rgba(34, 197, 94, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Voltage (V)'
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Input vs. Output Voltage'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed.y.toFixed(2) + ' V';
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 0 // Disable animation for real-time slider updates
                    }
                }
            });
        } else {
            opAmpChart.data.datasets[0].data = [vin, vout];
            opAmpChart.update();
        }
    }

    vinInput.addEventListener('input', updateSandbox);
    r1Input.addEventListener('input', updateSandbox);
    rfInput.addEventListener('input', updateSandbox);

    // Initial setup
    document.querySelector('.nav-link[data-target="concepts"]').click();
    document.querySelector('.concept-tab[data-concept="op_amp_basics"]').click();
    renderPracticeProblems();
    renderQuiz();
    updateSandbox(); // Initial sandbox chart render
});
</script>
</body>
</html>