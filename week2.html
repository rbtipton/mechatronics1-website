<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mechatronics 1: Week 2 - DC Circuit Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Academic Blue -->
    <!-- Application Structure Plan: The SPA is structured using a main navigation bar to switch between three sections: 'Analysis Techniques', 'Interactive Sandbox', and 'Practice Problems'. The 'Analysis Techniques' section uses a sub-navigation (tabs) for 'Nodal Analysis', 'Mesh Analysis', 'Superposition', 'Thevenin's Theorem', and 'Norton's Theorem'. This architecture organizes the content thematically, allowing students to focus on one technique at a time. The 'Interactive Sandbox' allows side-by-side comparison of results from different techniques on a single circuit. The user flow encourages progressive learning: grasp a concept, see it applied in an interactive calculation, compare results visually, and test knowledge. This is more effective than a static document. -->
    <!-- Visualization & Content Choices: Technique definitions/steps -> Styled text blocks (HTML/Tailwind). Math Examples -> Interactive step-by-step reveal with a button (JS). Circuit diagrams -> HTML/CSS divs for components and wires to avoid SVG. Sandbox Comparison -> Bar chart (Chart.js/Canvas) to verify consistent results across methods. Practice Problems -> Cards with a 'show answer' toggle (JS). This mix of static and interactive content enhances engagement and comprehension. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-active { 
            border-color: #3b82f6; /* blue-500 */
            color: #1d4ed8; /* blue-700 */
            background-color: #eff6ff; /* blue-50 */
        }
        .step-content {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .step-content.visible {
            display: block;
            opacity: 1;
        }
        .solution-box {
            background-color: #f8fafc;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .btn {
            background-color: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
            cursor: pointer;
        }
        .btn:hover { background-color: #2563eb; }
        .btn-secondary {
            background-color: #6b7280;
        }
        .btn-secondary:hover { background-color: #4b5563; }
        .hidden { display: none; }
        .katex-display { display: block; overflow-x: auto; white-space: nowrap; }

        /* Circuit Diagram Styling */
        .circuit-diagram {
            position: relative;
            background-color: #f3f4f6;
            border: 2px solid #d1d5db;
            padding: 1rem;
            border-radius: 0.5rem;
            min-height: 200px; /* Base height */
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Ensure contents don't spill out */
            margin-bottom: 1rem;
            box-sizing: border-box; /* Include padding/border in element's total width and height */
        }
        .component, .voltage-source, .current-source-symbol, .resistor-symbol, .node-label {
            position: absolute;
            font-size: 0.75rem;
            text-align: center;
            color: #374151;
            white-space: nowrap;
        }
        .resistor-symbol {
            width: 50px; /* Smaller to fit better */
            height: 15px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 80 20'%3E%3Cpath d='M0 10 L10 10 L15 15 L25 5 L35 15 L45 5 L55 15 L60 10 L80 10' fill='none' stroke='%23374151' stroke-width='2'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
        }
        .wire {
            position: absolute;
            background-color: #374151;
        }
        .voltage-source {
            width: 40px;
            height: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid #374151;
            border-radius: 50%;
            line-height: 1;
            font-weight: bold;
        }
        .current-source-symbol {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #374151;
            border-radius: 50%;
            font-weight: bold;
        }
        .arrow {
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            position: absolute;
        }
        .arrow-down { border-top: 8px solid #374151; top: 100%; left: 50%; transform: translateX(-50%); }
        .arrow-up { border-bottom: 8px solid #374151; bottom: 100%; left: 50%; transform: translateX(-50%); }
        .node-dot {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #374151;
            border-radius: 50%;
        }
        .ground-symbol-container {
            position: absolute;
            width: 20px;
            height: 15px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
        }
        .ground-symbol-container div { background-color: #374151; height: 2px; }
        .ground-symbol-container .line1 { width: 100%; }
        .ground-symbol-container .line2 { width: 70%; }
        .ground-symbol-container .line3 { width: 40%; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-10">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-bold text-blue-700">Mechatronics 1: Week 2 - DC Circuit Analysis</h1>
                <div class="flex space-x-4 text-sm font-medium">
                    <button data-target="techniques" class="nav-link px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">Analysis Techniques</button>
                    <button data-target="sandbox" class="nav-link px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">Interactive Sandbox</button>
                    <button data-target="practice" class="nav-link px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">Practice Problems</button>
                </div>
            </div>
        </nav>
    </header>

    <main id="app-container" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Section: Analysis Techniques -->
        <section id="techniques" class="app-section">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-3xl font-bold mb-4 text-gray-900">Advanced DC Circuit Analysis Techniques</h2>
                <p class="text-gray-600 mb-6">Last week, we covered the fundamentals. This week, we explore powerful, systematic methods to solve complex DC circuits with multiple sources and components. These techniques are essential tools for any mechatronics engineer. Select a technique below to learn more.</p>

                <!-- Tabs -->
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex flex-wrap" aria-label="Tabs">
                        <button class="technique-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-technique="nodal">Nodal Analysis</button>
                        <button class="technique-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-technique="mesh">Mesh Analysis</button>
                        <button class="technique-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-technique="superposition">Superposition</button>
                        <button class="technique-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-technique="thevenin">Thevenin's Theorem</button>
                        <button class="technique-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-technique="norton">Norton's Theorem</button>
                    </nav>
                </div>

                <!-- Content Area for Techniques -->
                <div id="technique-content" class="mt-6">
                    <!-- Content will be injected here by JS -->
                </div>
            </div>
        </section>

        <!-- Section: Interactive Sandbox -->
        <section id="sandbox" class="app-section hidden">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-3xl font-bold mb-2 text-gray-900">Interactive Sandbox: Compare Analysis Methods</h2>
                <p class="text-gray-600 mb-6">This sandbox allows you to analyze a single circuit using different methods and see how they all lead to the same result. Select a method below to see its step-by-step application and the final current through the 6Ω resistor.</p>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Sandbox Circuit</h3>
                        <div class="circuit-diagram h-64 md:h-80 relative">
                            <!-- Common circuit from Mesh/Superposition examples -->
                            <div class="voltage-source" style="top: 20%; left: 10%;"><span>+</span>20V<span>-</span></div>
                            <div class="resistor-symbol" style="top: 15%; left: 30%;"><span class="absolute -top-4 left-1/2 -translate-x-1/2">R1=2Ω</span></div>
                            <div class="resistor-symbol" style="top: 15%; left: 60%;"><span class="absolute -top-4 left-1/2 -translate-x-1/2">R2=4Ω</span></div>
                            <div class="voltage-source" style="top: 20%; right: 10%;"><span>+</span>10V<span>-</span></div>
                            <div class="resistor-symbol" style="top: 45%; left: 45%; transform: rotate(90deg);"><span class="absolute -left-8 top-1/2 -translate-y-1/2">R3=6Ω</span></div>
                            
                            <!-- Wires -->
                            <div class="wire" style="left: 10%; top: 45%; width: 2px; height: 35%;"></div> <!-- Left vertical -->
                            <div class="wire" style="left: 90%; top: 45%; width: 2px; height: 35%;"></div> <!-- Right vertical -->
                            <div class="wire" style="left: 10%; top: 45%; width: 80%; height: 2px;"></div> <!-- Top horizontal -->
                            <div class="wire" style="left: 10%; top: 80%; width: 80%; height: 2px;"></div> <!-- Bottom horizontal -->

                            <div class="wire" style="left: 45%; top: 45%; width: 2px; height: 35%;"></div> <!-- Middle vertical -->
                        </div>
                        <div class="mt-4 flex flex-wrap gap-2 justify-center">
                            <button class="sandbox-btn btn" data-method="mesh">Solve with Mesh Analysis</button>
                            <button class="sandbox-btn btn" data-method="superposition">Solve with Superposition</button>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Solution & Verification</h3>
                        <div id="sandbox-solution" class="bg-gray-100 p-4 rounded-lg min-h-64">
                            Select a method to see the step-by-step solution.
                        </div>
                        <div class="mt-4">
                            <div class="chart-container w-full max-w-lg mx-auto h-64 md:h-80 relative">
                                <canvas id="sandboxChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: Practice Problems -->
        <section id="practice" class="app-section hidden">
            <div class="bg-white p-6 rounded-lg shadow">
                 <h2 class="text-3xl font-bold mb-4 text-gray-900">Practice Problems</h2>
                 <p class="text-gray-600 mb-6">Test your understanding with these problems. Click "Show Answer" to reveal the detailed solution.</p>
                 <div id="practice-problems-container" class="space-y-6">
                    <!-- Practice problems will be injected here -->
                 </div>
                 <h2 class="text-3xl font-bold mt-8 mb-4 text-gray-900">Quiz</h2>
                 <p class="text-gray-600 mb-6">Challenge your knowledge with these multiple-choice questions. Select your answer and click 'Check Answer'.</p>
                 <div id="quiz-container" class="space-y-6">
                    <!-- Quiz questions will be injected here -->
                 </div>
            </div>
        </section>

    </main>
    
<script>
const appData = {
    nodal: {
        title: "Nodal Analysis (Based on KCL)",
        description: "Nodal analysis is a systematic method for solving circuits using Kirchhoff's Current Law (KCL). The primary goal is to find the node voltages (voltages at specific points relative to a reference node). Once node voltages are known, all other currents and voltages in the circuit can be easily determined using Ohm's Law. It's particularly effective for circuits with many parallel branches or voltage sources.",
        steps: [
            "Identify all nodes in the circuit. A node is a point where two or more circuit elements connect.",
            "Choose a reference node (ground) and label it 0V. This is often the node with the most connections.",
            "Label the voltages of all non-reference nodes with unique variables (e.g., V1, V2, ...).",
            "Apply KCL at each non-reference node. Assume currents leaving the node are positive. Write the currents in terms of the node voltages and resistances using Ohm's Law (I = (V_from - V_to) / R).",
            "Solve the resulting system of linear equations to find the unknown node voltages.",
            "Real-Life Application: Nodal analysis is critical in analyzing sensor networks to determine voltages at various sensor output points or junctions within a complex system, ensuring data integrity. It's also used in power distribution on PCBs to ensure stable voltage levels for ICs and components."
        ],
        example: {
            problem: "Find the node voltages V1 and V2 in the circuit below.",
            circuitHTML: `<div class="circuit-diagram h-64 relative">
                            <div class="voltage-source" style="top: 15%; left: 10%;"><span>+</span>10V<span>-</span></div>
                            <div class="resistor-symbol" style="top: 10%; left: 25%;"><span class="absolute -top-4 left-1/2 -translate-x-1/2">R1=2Ω</span></div>
                            <div class="node-label" style="top: 8%; left: 47%;">V1</div>
                            <div class="node-dot" style="top: 15%; left: 49.5%;"></div>
                            <div class="resistor-symbol" style="top: 10%; left: 60%;"><span class="absolute -top-4 left-1/2 -translate-x-1/2">R2=4Ω</span></div>
                            <div class="node-label" style="top: 8%; left: 87%;">V2</div>
                            <div class="node-dot" style="top: 15%; left: 89.5%;"></div>
                            <div class="resistor-symbol" style="top: 45%; left: 30%; transform: rotate(90deg);"><span class="absolute -left-8 top-1/2 -translate-y-1/2">R3=6Ω</span></div>
                            <div class="current-source-symbol" style="top: 55%; left: 70%;"><span class="absolute top-0 left-1/2 -translate-x-1/2 arrow arrow-up"></span>5A</div>
                            <div class resistor-symbol" style="top: 45%; left: 85%; transform: rotate(90deg);"><span class="absolute -left-8 top-1/2 -translate-y-1/2">R4=8Ω</span></div>
                            <div class="ground-symbol-container" style="bottom: 5%; left: 49%;">
                                <div class="line1"></div><div class="line2"></div><div class="line3"></div>
                            </div>

                            <!-- Wires -->
                            <div class="wire" style="top: 30%; left: 10%; width: 2px; height: 50%;"></div> <!-- left vertical from source -->
                            <div class="wire" style="top: 30%; left: 10%; width: 40%; height: 2px;"></div> <!-- left horizontal to V1 -->
                            <div class="wire" style="top: 30%; left: 50%; width: 40%; height: 2px;"></div> <!-- middle horizontal V1 to V2 -->
                            <div class="wire" style="top: 30%; left: 90%; width: 2px; height: 50%;"></div> <!-- right vertical from V2 -->

                            <div class="wire" style="top: 15%; left: 25%; width: 2px; height: 15%;"></div> <!-- R1 to V1 top -->
                            <div class="wire" style="top: 15%; left: 60%; width: 2px; height: 15%;"></div> <!-- R2 to V2 top -->

                            <div class="wire" style="top: 30%; left: 50%; width: 2px; height: 25%;"></div> <!-- V1 to R3 top -->
                            <div class="wire" style="top: 55%; left: 50%; width: 2px; height: 25%;"></div> <!-- R3 to ground -->

                            <div class="wire" style="top: 30%; left: 70%; width: 2px; height: 25%;"></div> <!-- Current source top -->
                            <div class="wire" style="top: 55%; left: 70%; width: 2px; height: 25%;"></div> <!-- Current source bottom -->

                            <div class="wire" style="top: 30%; left: 90%; width: 2px; height: 25%;"></div> <!-- V2 to R4 top -->
                            <div class="wire" style="top: 55%; left: 90%; width: 2px; height: 25%;"></div> <!-- R4 to ground -->

                            <div class="wire" style="bottom: 20%; left: 10%; width: 80%; height: 2px;"></div> <!-- Ground line -->
                         </div>`, 
            solutionSteps: [
                {
                    title: "Apply KCL at Node V1",
                    content: `We assume currents leaving the node are positive. The current from the 10V source through R1 to V1 is (V1 - 10)/2 (as 10V is the source voltage). The current from V1 to V2 through R2 is (V1 - V2)/4. The current from V1 to ground through R3 is V1/6.<br>
                    <div class="solution-box"> (V1 - 10)/2 + (V1 - V2)/4 + V1/6 = 0 </div>
                    Multiplying by the LCM (12) to clear denominators gives:<br>
                    <div class="solution-box"> 6(V1 - 10) + 3(V1 - V2) + 2V1 = 0 <br> 6V1 - 60 + 3V1 - 3V2 + 2V1 = 0 <br> 11V1 - 3V2 = 60 (Equation 1) </div>`
                },
                {
                    title: "Apply KCL at Node V2",
                    content: `Current from V2 to V1 through R2 is (V2 - V1)/4. Current from V2 to ground through R4 is V2/8. The 5A source exits V2, so it's +5.<br>
                    <div class="solution-box"> (V2 - V1)/4 + V2/8 + 5 = 0 </div>
                    Multiplying by the LCM (8) to clear denominators gives:<br>
                    <div class="solution-box"> 2(V2 - V1) + V2 + 40 = 0 <br> 2V2 - 2V1 + V2 + 40 = 0 <br> -2V1 + 3V2 = -40 (Equation 2) </div>`
                },
                {
                    title: "Solve the System of Equations",
                    content: `We have a system of two linear equations:<br>
                    1) 11V1 - 3V2 = 60 <br>
                    2) -2V1 + 3V2 = -40 <br>
                    Adding Equation 1 and Equation 2 (eliminating V2):<br>
                    <div class="solution-box"> (11V1 - 2V1) + (-3V2 + 3V2) = 60 - 40 <br> 9V1 = 20 <br> V1 = 20/9 ≈ 2.222V </div>
                    Substitute V1 into Equation 2:<br>
                    <div class="solution-box"> -2(20/9) + 3V2 = -40 <br> -40/9 + 3V2 = -40 <br> 3V2 = -40 + 40/9 = (-360 + 40)/9 = -320/9 <br> V2 = -320/27 ≈ -11.852V </div>`
                },
                {
                    title: "Final Answer",
                    content: `<div class="p-4 bg-green-100 text-green-800 rounded-lg">Node Voltages: <br> V1 ≈ <strong>2.222V</strong> <br> V2 ≈ <strong>-11.852V</strong> </div>`
                }
            ]
        }
    },
    mesh: {
        title: "Mesh Analysis (Based on KVL)",
        description: "Mesh analysis is a systematic method for solving circuits using Kirchhoff's Voltage Law (KVL). It is particularly useful for planar circuits (circuits that can be drawn without crossing wires) and is efficient when dealing with circuits containing many series components or voltage sources. The primary goal is to find 'mesh currents' – fictitious currents circulating in closed loops.",
        steps: [
            "Identify all meshes (loops that do NOT contain any other loops within them) in the circuit.",
            "Assign a mesh current (e.g., I1, I2, ...) to each mesh, typically in a clockwise direction for consistency.",
            "Apply KVL around each mesh. Sum voltage drops across resistors (using Ohm's Law, V=IR). For resistors shared between meshes, the current through it is the algebraic difference of the mesh currents passing through it. Account for voltage sources (add if traversing from negative to positive in the direction of your mesh current, subtract if positive to negative).",
            "Solve the resulting system of linear equations to find the unknown mesh currents.",
            "Once mesh currents are known, actual branch currents and component voltages can be derived.",
            "Real-Life Application: Mesh analysis is employed in motor control circuits to analyze currents in multi-phase windings or H-bridge motor drivers for precise control. It's also used in power supply networks within industrial machinery to ensure load balancing and identify overcurrents."
        ],
        example: {
            problem: "Find the mesh currents I1 and I2 and the current flowing through the 6Ω resistor (R3).",
            circuitHTML: `<div class="circuit-diagram h-64 relative">
                            <div class="voltage-source" style="top: 20%; left: 10%;"><span>+</span>20V<span>-</span></div>
                            <div class="resistor-symbol" style="top: 15%; left: 30%;"><span class="absolute -top-4 left-1/2 -translate-x-1/2">R1=2Ω</span></div>
                            <div class="resistor-symbol" style="top: 15%; left: 60%;"><span class="absolute -top-4 left-1/2 -translate-x-1/2">R2=4Ω</span></div>
                            <div class="voltage-source" style="top: 20%; right: 10%;"><span>+</span>10V<span>-</span></div>
                            <div class="resistor-symbol" style="top: 45%; left: 45%; transform: rotate(90deg);"><span class="absolute -left-8 top-1/2 -translate-y-1/2">R3=6Ω</span></div>
                            
                            <!-- Mesh Labels (Illustrative, not part of actual circuit) -->
                            <div class="node-label font-bold text-blue-700" style="top: 60%; left: 25%;">I1</div>
                            <div class="node-label font-bold text-blue-700" style="top: 60%; left: 75%;">I2</div>

                            <!-- Wires -->
                            <div class="wire" style="left: 10%; top: 45%; width: 2px; height: 35%;"></div> <!-- Left vertical from source -->
                            <div class="wire" style="left: 90%; top: 45%; width: 2px; height: 35%;"></div> <!-- Right vertical from source -->
                            <div class="wire" style="left: 10%; top: 45%; width: 80%; height: 2px;"></div> <!-- Top horizontal -->
                            <div class="wire" style="left: 10%; top: 80%; width: 80%; height: 2px;"></div> <!-- Bottom horizontal -->

                            <div class="wire" style="left: 45%; top: 45%; width: 2px; height: 35%;"></div> <!-- Middle vertical -->
                        </div>`,
            solutionSteps: [
                 {
                    title: "Apply KVL to Mesh 1 (Left Loop)",
                    content: `Traverse the left loop clockwise. We encounter a voltage rise (+20V) from the source. The voltage drop across R1 (2Ω) is I1 * 2. The voltage drop across R3 (6Ω), which is shared, is 6 * (I1 - I2) because I1 goes down through R3 and I2 goes up.<br>
                    <div class="solution-box"> +20 - (I1 ⋅ 2) - 6(I1 - I2) = 0 <br> 20 - 2I1 - 6I1 + 6I2 = 0 <br> -8I1 + 6I2 = -20 <br> 8I1 - 6I2 = 20 (Equation 1) </div>`
                },
                {
                    title: "Apply KVL to Mesh 2 (Right Loop)",
                    content: `Traverse the right loop clockwise. The voltage drop across R3 (6Ω) is 6 * (I2 - I1) (because I2 goes up through R3 and I1 goes down). The voltage drop across R2 (4Ω) is I2 * 4. We traverse the 10V source from positive to negative, so it's a voltage drop (-10V).<br>
                    <div class="solution-box"> -6(I2 - I1) - (I2 ⋅ 4) - 10 = 0 <br> -6I2 + 6I1 - 4I2 - 10 = 0 <br> 6I1 - 10I2 = 10 (Equation 2) </div>`
                },
                {
                    title: "Solve the System of Equations",
                    content: `We have two linear equations:<br>
                    1) 8I1 - 6I2 = 20 <br>
                    2) 6I1 - 10I2 = 10 <br>
                    To solve using elimination, multiply Equation 1 by 5 and Equation 2 by 3:<br>
                    40I1 - 30I2 = 100 <br>
                    18I1 - 30I2 = 30 <br>
                    Subtract the second new equation from the first:<br>
                    <div class="solution-box"> (40I1 - 18I1) - (30I2 - 30I2) = 100 - 30 <br> 22I1 = 70 <br> I1 = 70/22 = 35/11 ≈ 3.182A </div>
                    Substitute I1 back into Equation 2:<br>
                    <div class="solution-box"> 6(35/11) - 10I2 = 10 <br> 210/11 - 10I2 = 10 <br> -10I2 = 10 - 210/11 = (110 - 210)/11 = -100/11 <br> I2 = (-100/11) / -10 = 10/11 ≈ 0.909A </div>`
                },
                {
                    title: "Find Current through 6Ω Resistor (R3)",
                    content: `The actual current through R3 is the difference between the mesh currents flowing through it. Since I1 flows downwards and I2 flows upwards (in relation to our clockwise assumption), the net current downwards is I1 - I2.<br>
                    <div class="p-4 bg-green-100 text-green-800 rounded-lg">Current through R3: I_R3 = I1 - I2 = 3.182A - 0.909A ≈ <strong>2.273A</strong> (downwards)</div>`
                }
            ]
        }
    },
    superposition: {
        title: "Superposition Principle",
        description: "The Superposition Principle states that in any linear circuit with multiple independent sources, the total current or voltage at any point is the algebraic sum of the contributions from each independent source acting alone. This simplifies complex circuits by breaking them into multiple simpler circuits.",
        steps: [
            "Select one independent source (voltage or current) in the circuit.",
            "\"Turn off\" all other independent sources: replace independent voltage sources with a short circuit (0V) and independent current sources with an open circuit (0A).",
            "Calculate the desired current or voltage (e.g., through a specific resistor) in this simplified circuit due to the single active source.",
            "Repeat steps 1-3 for each independent source in the original circuit.",
            "Algebraically sum all the individual contributions to find the total current or voltage at the desired point. **Crucially, pay attention to the direction of currents and polarity of voltages for each contribution.**",
            "Real-Life Application: Superposition is useful in mixed-signal systems to analyze how both DC power supplies and AC control signals affect a sensor or motor circuit. It allows separate analysis of DC bias and AC response, which is crucial for noise reduction and multi-input control systems."
        ],
         example: {
            problem: "Use the Superposition Principle to find the current flowing through the 3Ω resistor (R2). Assume current is positive downwards through R2.",
            circuitHTML: `<div class="circuit-diagram h-64 relative">
                            <div class="voltage-source" style="top: 20%; left: 10%;"><span>+</span>10V<span>-</span></div>
                            <div class="resistor-symbol" style="top: 15%; left: 30%;"><span class="absolute -top-4 left-1/2 -translate-x-1/2">R1=2Ω</span></div>
                            <div class="resistor-symbol" style="top: 15%; left: 60%;"><span class="absolute -top-4 left-1/2 -translate-x-1/2">R2=3Ω</span></div>
                            <div class="current-source-symbol" style="top: 20%; right: 10%;"><span class="absolute top-0 left-1/2 -translate-x-1/2 arrow arrow-down"></span>4A</div>
                            
                            <!-- Wires -->
                            <div class="wire" style="left: 10%; top: 45%; width: 2px; height: 35%;"></div> <!-- Left vertical from source -->
                            <div class="wire" style="left: 90%; top: 45%; width: 2px; height: 35%;"></div> <!-- Right vertical from current source -->
                            <div class="wire" style="left: 10%; top: 45%; width: 80%; height: 2px;"></div> <!-- Top horizontal -->
                            <div class="wire" style="left: 10%; top: 80%; width: 80%; height: 2px;"></div> <!-- Bottom horizontal (ground) -->
                        </div>`,
            solutionSteps: [
                {
                    title: "Case 1: 10V Voltage Source Acting Alone",
                    content: `Replace the 4A current source with an **open circuit**. The circuit becomes a simple series circuit with the 10V source, R1 (2Ω), and R2 (3Ω).<br>
                    Total Equivalent Resistance: R_eq = R1 + R2 = 2Ω + 3Ω = 5Ω.<br>
                    Total Current: I_total = V / R_eq = 10V / 5Ω = 2A.<br>
                    Since R1 and R2 are in series, this 2A current flows through R2.<br>
                    <div class="solution-box">Contribution 1 (I_R2,1): <strong>2A</strong> (downwards through R2).</div>`
                },
                {
                    title: "Case 2: 4A Current Source Acting Alone",
                    content: `Replace the 10V voltage source with a **short circuit**. The 4A current source's current now splits between R1 (2Ω) and R2 (3Ω), which are in parallel due to the shorted voltage source.<br>
                    Use the Current Divider Rule to find the current through R2 (I_R2,2).<br>
                    <div class="solution-box">I_R2,2 = I_total ⋅ (R_opposite / (R_opposite + R_current_branch)) <br> I_R2,2 = 4A ⋅ (2Ω / (2Ω + 3Ω)) = 4A ⋅ (2/5) = 1.6A </div>
                    <div class="solution-box">Contribution 2 (I_R2,2): <strong>1.6A</strong> (downwards through R2).</div>`
                },
                {
                    title: "Final Summation",
                    content: `Since both contributions for the current through R2 are in the same direction (downwards), we add them algebraically.<br>
                    <div class="p-4 bg-green-100 text-green-800 rounded-lg">Total Current through R2: I_R2 = I_R2,1 + I_R2,2 = 2A + 1.6A = <strong>3.6A</strong> (downwards).</div>`
                }
            ]
        }
    },
    thevenin: {
        title: "Thevenin's Theorem",
        description: "Thevenin's Theorem allows any complex linear circuit to be replaced by a simpler **Thevenin equivalent circuit** as viewed from any two output terminals (a-b). This equivalent circuit consists of a single Thevenin voltage source (V_Th) in series with a single Thevenin resistance (R_Th). This drastically simplifies analyzing a load's behavior when connected to a complex source circuit.",
        steps: [
            "Identify the two terminals (a-b) of interest where you want to find the equivalent circuit. Remove any load connected there.",
            "Calculate V_Th (Thevenin Voltage): This is the **open-circuit voltage** across the two terminals (a-b). Use KVL, KCL, Nodal, or Mesh analysis to find it.",
            "Calculate R_Th (Thevenin Resistance): To find R_Th, \"turn off\" all independent sources in the original circuit (replace independent voltage sources with a short circuit, and independent current sources with an open circuit). Then, find the equivalent resistance looking back into terminals a-b.",
            "Draw the Thevenin equivalent circuit: Place V_Th in series with R_Th. You can then connect any load back to these terminals for simplified analysis.",
            "Real-Life Application: Thevenin's theorem is used to model real batteries as an ideal voltage source in series with an internal resistance, helping predict battery voltage drop under load. It's also vital in sensor interface design, simplifying complex sensor outputs for optimal matching with amplifier inputs, and modularizing large mechatronic systems."
        ],
         example: {
            problem: "Find the Thevenin equivalent circuit for the circuit below with respect to terminals a-b.",
            circuitHTML: `<div class="circuit-diagram h-64 relative">
                            <div class="voltage-source" style="top: 20%; left: 10%;"><span>+</span>5V<span>-</span></div>
                            <div class="resistor-symbol" style="top: 15%; left: 30%;"><span class="absolute -top-4 left-1/2 -translate-x-1/2">R1=1Ω</span></div>
                            <div class="resistor-symbol" style="top: 45%; left: 20%; transform: rotate(90deg);"><span class="absolute -left-8 top-1/2 -translate-y-1/2">R2=2Ω</span></div>
                            <div class="resistor-symbol" style="top: 15%; left: 60%;"><span class="absolute -top-4 left-1/2 -translate-x-1/2">R3=4Ω</span></div>
                            
                            <div class="node-label" style="top: 8%; right: 8%;">a</div>
                            <div class="node-dot" style="top: 15%; right: 9.5%;"></div>
                            <div class="node-label" style="bottom: 8%; right: 8%;">b</div>
                            <div class="node-dot" style="bottom: 15%; right: 9.5%;"></div>

                            <div class="ground-symbol-container" style="bottom: 5%; left: 49%;">
                                <div class="line1"></div><div class="line2"></div><div class="line3"></div>
                            </div>
                            
                            <!-- Wires -->
                            <div class="wire" style="left: 10%; top: 45%; width: 2px; height: 35%;"></div> <!-- Left vertical from source -->
                            <div class="wire" style="left: 10%; top: 45%; width: 20%; height: 2px;"></div> <!-- Left horizontal to R2/R1 junction -->
                            <div class="wire" style="left: 30%; top: 45%; width: 40%; height: 2px;"></div> <!-- Horizontal to R3/a junction -->
                            <div class="wire" style="right: 10%; top: 45%; width: 2px; height: 35%;"></div> <!-- Right vertical to b -->

                            <div class="wire" style="top: 15%; left: 25%; width: 2px; height: 30%;"></div> <!-- R1 top to R1 bottom -->
                            <div class="wire" style="top: 15%; left: 60%; width: 2px; height: 30%;"></div> <!-- R3 top to R3 bottom -->

                            <div class="wire" style="bottom: 20%; left: 10%; width: 80%; height: 2px;"></div> <!-- Ground line -->
                        </div>`,
            solutionSteps: [
                {
                    title: "Step 1: Find V_Th (Open-Circuit Voltage across a-b)",
                    content: `With terminals a-b open, no current flows through R3 (4Ω) since it's connected only at one end to the path and at the other end to the open circuit. Thus, the voltage at terminal 'a' will be the same as the voltage at the node above R3, and the voltage at terminal 'b' will be the same as the voltage at the node below R3, which is ground (0V). The voltage across 'a-b' is simply the voltage at 'a' relative to 'b' (ground). <br>
                    The 5V source, R1 (1Ω), and R2 (2Ω) form a simple series voltage divider. V_Th is the voltage across R2 (2Ω).<br>
                    <div class="solution-box"> V_Th = V_source ⋅ (R2 / (R1 + R2)) <br> V_Th = 5V ⋅ (2Ω / (1Ω + 2Ω)) = 5V ⋅ (2/3) = 10/3V ≈ 3.333V </div>`
                },
                {
                    title: "Step 2: Find R_Th (Equivalent Resistance looking into a-b)",
                    content: `Turn off the 5V independent voltage source (replace with a short circuit). Now, looking into terminals a-b, we see R3 (4Ω) is in series with the parallel combination of R1 (1Ω) and R2 (2Ω).<br>
                    First, calculate the parallel combination of R1 and R2:<br>
                    <div class="solution-box"> R_parallel = (R1 ⋅ R2) / (R1 + R2) = (1Ω ⋅ 2Ω) / (1Ω + 2Ω) = 2/3Ω ≈ 0.667Ω </div>
                    Then, add R3 in series:<br>
                    <div class="solution-box"> R_Th = R3 + R_parallel = 4Ω + 2/3Ω = 12/3Ω + 2/3Ω = 14/3Ω ≈ 4.667Ω </div>`
                },
                {
                    title: "Thevenin Equivalent Circuit",
                    content: `<div class="p-4 bg-green-100 text-green-800 rounded-lg">The Thevenin equivalent circuit consists of a voltage source of V_Th ≈ <strong>3.333V</strong> in series with a resistor of R_Th ≈ <strong>4.667Ω</strong>.</div>`
                },
                {
                    title: "Real-Life Application Example: Battery Modeling",
                    content: `A real battery is not an ideal voltage source; it has an internal resistance. Thevenin's theorem allows us to model a real battery as an ideal voltage source (V_Th, the open-circuit voltage when new) in series with an internal resistance (R_Th). This model helps predict how the battery's terminal voltage will drop under different loads, giving a more accurate representation of its real-world performance.`
                }
            ]
        }
    },
    norton: {
        title: "Norton's Theorem",
        description: "Norton's Theorem simplifies any complex linear circuit to an equivalent circuit containing a single **Norton current source (I_N)** in parallel with a single **Norton resistance (R_N)** as viewed from any two output terminals (a-b). It is particularly useful for analyzing loads connected in parallel or when dealing with current-output devices. Importantly, R_N is always equal to R_Th.",
        steps: [
            "Identify the two terminals (a-b) of interest and remove any load connected there.",
            "Calculate I_N (Norton Current): This is the **short-circuit current** that flows directly between terminals a-b if they were directly shorted together. Use KVL, KCL, Nodal, or Mesh analysis to find this current.",
            "Calculate R_N (Norton Resistance): This is identical to R_Th from Thevenin's Theorem. \"Turn off\" all independent sources (short voltage sources, open current sources) and find the equivalent resistance looking back into terminals a-b. (R_N = R_Th).",
            "Draw the Norton equivalent circuit: Place I_N in parallel with R_N. Any load can then be connected in parallel with this equivalent circuit for simplified analysis.",
            "Relationship to Thevenin: These two theorems are duals and directly interconvertible: V_Th = I_N ⋅ R_N and I_N = V_Th / R_Th. This conversion flexibility is powerful in circuit analysis."
        ],
         example: {
            problem: "Find the Norton equivalent circuit for the circuit below with respect to terminals a-b.",
            circuitHTML: `<div class="circuit-diagram h-64 relative">
                            <div class="voltage-source" style="top: 20%; left: 10%;"><span>+</span>20V<span>-</span></div>
                            <div class="resistor-symbol" style="top: 15%; left: 30%;"><span class="absolute -top-4 left-1/2 -translate-x-1/2">R1=10Ω</span></div>
                            <div class="resistor-symbol" style="top: 45%; left: 20%; transform: rotate(90deg);"><span class="absolute -left-8 top-1/2 -translate-y-1/2">R2=5Ω</span></div>
                            <div class="current-source-symbol" style="top: 55%; left: 50%;"><span class="absolute top-0 left-1/2 -translate-x-1/2 arrow arrow-up"></span>2A</div>
                            <div class="resistor-symbol" style="top: 15%; left: 60%;"><span class="absolute -top-4 left-1/2 -translate-x-1/2">R3=15Ω</span></div>
                            
                            <div class="node-label" style="top: 8%; right: 8%;">a</div>
                            <div class="node-dot" style="top: 15%; right: 9.5%;"></div>
                            <div class="node-label" style="bottom: 8%; right: 8%;">b</div>
                            <div class="node-dot" style="bottom: 15%; right: 9.5%;"></div>

                            <div class="ground-symbol-container" style="bottom: 5%; left: 49%;">
                                <div class="line1"></div><div class="line2"></div><div class="line3"></div>
                            </div>
                            
                            <!-- Wires -->
                            <div class="wire" style="left: 10%; top: 45%; width: 2px; height: 35%;"></div> <!-- Left vertical from source -->
                            <div class="wire" style="left: 10%; top: 45%; width: 20%; height: 2px;"></div> <!-- Left horizontal to R2/R1 junction -->
                            <div class="wire" style="left: 30%; top: 45%; width: 20%; height: 2px;"></div> <!-- Horizontal to current source -->
                            <div class="wire" style="left: 50%; top: 45%; width: 20%; height: 2px;"></div> <!-- Horizontal from current source to R3 -->
                            <div class="wire" style="right: 10%; top: 45%; width: 2px; height: 35%;"></div> <!-- Right vertical to b -->

                            <div class="wire" style="top: 15%; left: 25%; width: 2px; height: 30%;"></div> <!-- R1 top to R1 bottom -->
                            <div class="wire" style="top: 15%; left: 60%; width: 2px; height: 30%;"></div> <!-- R3 top to R3 bottom -->

                            <div class="wire" style="bottom: 20%; left: 10%; width: 80%; height: 2px;"></div> <!-- Ground line -->
                        </div>`,
            solutionSteps: [
                 {
                    title: "Step 1: Find R_N (Norton Resistance)",
                    content: `The Norton Resistance (R_N) is identical to the Thevenin Resistance (R_Th). To find it, turn off all independent sources: The 20V voltage source becomes a short circuit. The 2A current source becomes an open circuit. <br>
                    Looking into terminals a-b, R3 (15Ω) is in series with the parallel combination of R1 (10Ω) and R2 (5Ω). <br>
                    First, calculate the parallel combination of R1 and R2: <br>
                    <div class="solution-box"> R_parallel = (R1 ⋅ R2) / (R1 + R2) = (10Ω ⋅ 5Ω) / (10Ω + 5Ω) = 50/15Ω = 10/3Ω ≈ 3.333Ω </div>
                    Then, add R3 in series: <br>
                    <div class="solution-box"> R_N = R3 + R_parallel = 15Ω + 10/3Ω = 45/3Ω + 10/3Ω = 55/3Ω ≈ 18.333Ω </div>`
                },
                {
                    title: "Step 2: Find I_N (Short-Circuit Current across a-b)",
                    content: `Place a short circuit directly across terminals a-b. This short circuit bypasses R3 (15Ω), meaning all current that would normally flow through R3 now flows through the short. <br>
                    The current through the short (I_N) is the sum of currents contributed by the 20V source and the 2A source. <br>
                    Current from 20V source branch: The 20V source, R1 (10Ω), and R2 (5Ω) form a series path. The current here is I = 20V / (10Ω + 5Ω) = 20V / 15Ω = 4/3A ≈ 1.333A. This current flows into the short at 'a'. <br>
                    Current from 2A source: The 2A current source also flows directly towards the short. <br>
                    <div class="solution-box"> I_N = (Current from 20V source) + (Current from 2A source) <br> I_N = 4/3A + 2A = 4/3A + 6/3A = 10/3A ≈ 3.333A </div>`
                },
                 {
                    title: "Norton Equivalent Circuit",
                    content: `<div class="p-4 bg-green-100 text-green-800 rounded-lg">The Norton equivalent circuit consists of a current source of I_N ≈ <strong>3.333A</strong> in parallel with a resistor of R_N ≈ <strong>18.333Ω</strong>.</div>`
                }
            ]
        }
    }
};

const practiceProblems = [
    {
        id: 1,
        title: "Nodal Analysis Problem",
        problemHTML: `Consider a circuit with a 12V voltage source connected to a 4Ω resistor (R1). This branches into two paths: one with a 6Ω resistor (R2) and another with an 8Ω resistor (R3) in series with a 2A current source flowing towards the ground. All components connect to a common ground. Using Nodal Analysis, find the voltage at the node between R1 and the parallel branches.`,
        answerHTML: `<b>Solution:</b><br>
        Let V1 be the node voltage. <br>
        Apply KCL at V1: (V1 - 12)/4 + V1/6 + (V1 - 0)/8 - 2 = 0 (assuming current source flows out, so it's -2 if it flows into the node)<br>
        Multiply by LCM (24): 6(V1 - 12) + 4V1 + 3V1 - 48 = 0 <br>
        6V1 - 72 + 4V1 + 3V1 - 48 = 0 <br>
        13V1 = 120 <br>
        <div class="solution-box">V1 = 120/13 ≈ 9.23V</div>`
    },
    {
        id: 2,
        title: "Mesh Analysis Problem",
        problemHTML: `In a two-mesh circuit: Mesh 1 has a 15V voltage source, a 5Ω resistor (R1), and a shared 10Ω resistor (R2). Mesh 2 has the shared 10Ω resistor (R2) and a 20Ω resistor (R3), and a 10V voltage source (positive at top). Find the mesh currents I1 and I2.`,
        answerHTML: `<b>Solution:</b><br>
        KVL Mesh 1 (clockwise): +15V - (I1 * 5Ω) - 10Ω * (I1 - I2) = 0 => 15 - 5I1 - 10I1 + 10I2 = 0 => 15I1 - 10I2 = 15 (Eq 1)<br>
        KVL Mesh 2 (clockwise): -10Ω * (I2 - I1) - (I2 * 20Ω) - 10V = 0 => -10I2 + 10I1 - 20I2 - 10 = 0 => 10I1 - 30I2 = 10 (Eq 2)<br>
        From Eq 2: I1 = 1 + 3I2. Substitute into Eq 1:<br>
        15(1 + 3I2) - 10I2 = 15<br>
        15 + 45I2 - 10I2 = 15<br>
        35I2 = 0 => I2 = 0A<br>
        Substitute I2 back: I1 = 1 + 3(0) => I1 = 1A<br>
        <div class="solution-box">I1 = 1A, I2 = 0A</div>`
    },
    {
        id: 3,
        title: "Superposition Problem",
        problemHTML: `A circuit has a 6V voltage source and a 3A current source. Both are connected to a parallel combination of a 2Ω resistor (R1) and a 4Ω resistor (R2). Find the current through the 4Ω resistor (R2) using Superposition.`,
        answerHTML: `<b>Solution:</b><br>
        Case 1 (6V source active, 3A source open):<br>
        Current through R2 = 6V / (2Ω + 4Ω) = 6V / 6Ω = 1A.<br>
        Case 2 (3A source active, 6V source shorted):<br>
        R1 and R2 are in parallel. Using Current Divider:<br>
        I_R2 = 3A * (2Ω / (2Ω + 4Ω)) = 3A * (2/6) = 3A * (1/3) = 1A.<br>
        Total current through R2 = 1A (from 6V) + 1A (from 3A) = 2A.<br>
        <div class="solution-box">Current through 4Ω resistor = 2A</div>`
    },
    {
        id: 4,
        title: "Thevenin & Norton Equivalence",
        problemHTML: `If a Thevenin equivalent circuit has V_Th = 10V and R_Th = 5Ω, what is its equivalent Norton current (I_N) and Norton resistance (R_N)?`,
        answerHTML: `<b>Solution:</b><br>
        R_N = R_Th = 5Ω.<br>
        I_N = V_Th / R_Th = 10V / 5Ω = 2A.<br>
        <div class="solution-box">I_N = 2A, R_N = 5Ω</div>`
    }
];

const quizQuestions = [
    {
        id: 1,
        question: "Which circuit analysis technique is primarily based on Kirchhoff's Current Law (KCL)?",
        options: ["Mesh Analysis", "Nodal Analysis", "Superposition Principle", "Thevenin's Theorem"],
        answer: "Nodal Analysis",
        explanation: "Nodal analysis focuses on finding unknown node voltages by applying KCL at each non-reference node."
    },
    {
        id: 2,
        question: "When applying the Superposition Principle, how do you 'turn off' an independent voltage source?",
        options: ["Replace it with an open circuit", "Replace it with a short circuit", "Replace it with a resistor equal to its internal resistance", "Reverse its polarity"],
        answer: "Replace it with a short circuit",
        explanation: "Turning off a voltage source means setting its voltage to zero, which is equivalent to a short circuit."
    },
    {
        id: 3,
        question: "What is the relationship between Thevenin resistance (R_Th) and Norton resistance (R_N) for the same circuit?",
        options: ["R_N = 1 / R_Th", "R_N = R_Th", "R_N = R_Th / 2", "R_N = R_Th ⋅ V_Th"],
        answer: "R_N = R_Th",
        explanation: "The equivalent resistance looking back into the terminals is the same for both Thevenin and Norton equivalent circuits."
    },
    {
        id: 4,
        question: "Which analysis technique is best suited for planar circuits with many voltage sources and series components?",
        options: ["Nodal Analysis", "Superposition Principle", "Mesh Analysis", "Current Divider Rule"],
        answer: "Mesh Analysis",
        explanation: "Mesh analysis directly uses KVL around loops, which is efficient for circuits with many series elements and voltage sources."
    }
];


document.addEventListener('DOMContentLoaded', () => {
    const navLinks = document.querySelectorAll('.nav-link');
    const appSections = document.querySelectorAll('.app-section');
    const techniqueTabs = document.querySelectorAll('.technique-tab');
    const techniqueContentContainer = document.getElementById('technique-content');
    let sandboxChart = null;

    // Main navigation
    navLinks.forEach(link => {
        link.addEventListener('click', () => {
            const targetId = link.dataset.target;
            appSections.forEach(section => section.classList.toggle('hidden', section.id !== targetId));
            navLinks.forEach(l => l.classList.remove('font-bold', 'text-blue-600'));
            link.classList.add('font-bold', 'text-blue-600');
        });
    });

    // Technique tabs
    techniqueTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const techniqueId = tab.dataset.technique;
            techniqueTabs.forEach(t => t.classList.remove('tab-active'));
            tab.classList.add('tab-active');
            renderTechnique(techniqueId);
        });
    });

    function renderTechnique(techniqueId) {
        const data = appData[techniqueId];
        if (!data) return;

        let stepsHTML = data.steps.map(step => `<li class="mb-2">${step}</li>`).join('');
        let exampleStepsHTML = data.example.solutionSteps.map((step, index) => `
            <div id="step-${index}" class="step-content border-t pt-4 mt-4">
                <h4 class="font-semibold text-lg text-blue-700">${step.title}</h4>
                <div class="text-gray-700 mt-2">${step.content}</div>
            </div>
        `).join('');

        techniqueContentContainer.innerHTML = `
            <h3 class="text-2xl font-bold text-gray-800">${data.title}</h3>
            <p class="mt-2 mb-4 text-gray-600">${data.description}</p>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h4 class="text-xl font-semibold mb-2">General Steps & Real-Life Application</h4>
                    <ul class="list-decimal list-inside text-gray-700 space-y-1">${stepsHTML}</ul>
                </div>
                <div>
                    <h4 class="text-xl font-semibold mb-2">Interactive Example: ${data.example.problem}</h4>
                    ${data.example.circuitHTML || ''}
                    <div id="example-steps-container">${exampleStepsHTML}</div>
                    <div class="mt-4 flex space-x-2">
                         <button id="next-step-btn" class="btn">Start</button>
                         <button id="reset-steps-btn" class="btn btn-secondary">Reset</button>
                    </div>
                </div>
            </div>`;
        
        setupInteractiveExample();
    }
    
    let currentStep = -1;
    function setupInteractiveExample() {
        const nextBtn = document.getElementById('next-step-btn');
        const resetBtn = document.getElementById('reset-steps-btn');
        const steps = document.querySelectorAll('.step-content');
        currentStep = -1;

        const showNextStep = () => {
            if (currentStep >= 0) {
                steps[currentStep].classList.remove('visible');
            }
            currentStep++;
            if (currentStep < steps.length) {
                steps[currentStep].classList.add('visible');
                nextBtn.textContent = 'Next Step';
            }
            if (currentStep >= steps.length - 1) {
                nextBtn.disabled = true;
                nextBtn.textContent = 'Finished';
            }
        };

        const resetSteps = () => {
            steps.forEach(step => step.classList.remove('visible'));
            currentStep = -1;
            nextBtn.disabled = false;
            nextBtn.textContent = 'Start';
        };

        nextBtn.addEventListener('click', showNextStep);
        resetBtn.addEventListener('click', resetSteps);
    }
    
    function renderPracticeProblems() {
        const container = document.getElementById('practice-problems-container');
        container.innerHTML = practiceProblems.map(p => `
            <div class="border rounded-lg p-4">
                <h4 class="text-lg font-semibold">${p.title}</h4>
                <p class="mt-2 text-gray-700">${p.problemHTML}</p>
                <div id="answer-${p.id}" class="mt-4 p-4 bg-blue-50 rounded hidden">
                   ${p.answerHTML}
                </div>
                <button data-answer-id="${p.id}" class="toggle-answer-btn btn mt-4 text-sm">Show Answer</button>
            </div>
        `).join('');

        document.querySelectorAll('.toggle-answer-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const answerId = btn.dataset.answerId;
                const answerEl = document.getElementById(`answer-${answerId}`);
                answerEl.classList.toggle('hidden');
                btn.textContent = answerEl.classList.contains('hidden') ? 'Show Answer' : 'Hide Answer';
            });
        });
    }

    function renderQuiz() {
        const container = document.getElementById('quiz-container');
        container.innerHTML = quizQuestions.map((q, index) => `
            <div class="border rounded-lg p-4">
                <h4 class="text-lg font-semibold mb-3">Q${index + 1}: ${q.question}</h4>
                <div class="space-y-2">
                    ${q.options.map((option, optIndex) => `
                        <label class="block">
                            <input type="radio" name="quiz-q${q.id}" value="${option}" class="mr-2">
                            ${option}
                        </label>
                    `).join('')}
                </div>
                <button data-question-id="${q.id}" class="check-quiz-btn btn mt-4 text-sm">Check Answer</button>
                <div id="quiz-feedback-${q.id}" class="mt-3 text-sm font-semibold"></div>
            </div>
        `).join('');

        document.querySelectorAll('.check-quiz-btn').forEach(btn => {
            btn.addEventListener('click', (event) => {
                const questionId = btn.dataset.questionId;
                const selectedOption = document.querySelector(`input[name="quiz-q${questionId}"]:checked`);
                const feedbackEl = document.getElementById(`quiz-feedback-${questionId}`);
                const question = quizQuestions.find(q => q.id == questionId);

                if (!selectedOption) {
                    feedbackEl.innerHTML = `<span class="text-yellow-600">Please select an option.</span>`;
                    return;
                }

                if (selectedOption.value === question.answer) {
                    feedbackEl.innerHTML = `<span class="text-green-600">Correct!</span> ${question.explanation}`;
                } else {
                    feedbackEl.innerHTML = `<span class="text-red-600">Incorrect.</span> The correct answer is: <strong>${question.answer}</strong>. ${question.explanation}`;
                }
            });
        });
    }

    // Sandbox logic
    const sandboxBtns = document.querySelectorAll('.sandbox-btn');
    const sandboxSolutionEl = document.getElementById('sandbox-solution');
    const sandboxChartCtx = document.getElementById('sandboxChart').getContext('2d');
    
    function updateSandboxChart(label, value) {
        if (!sandboxChart) {
            sandboxChart = new Chart(sandboxChartCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Current through 6Ω Resistor (A)',
                        data: [],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.6)',
                            'rgba(22, 163, 74, 0.6)'
                        ],
                        borderColor: [
                            'rgba(59, 130, 246, 1)',
                            'rgba(22, 163, 74, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Current (A)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Verification Chart: 6Ω Resistor Current'
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return context[0].label;
                                },
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.parsed.x.toFixed(3) + 'A';
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        const existingLabelIndex = sandboxChart.data.labels.indexOf(label);
        if(existingLabelIndex === -1) {
            sandboxChart.data.labels.push(label);
            sandboxChart.data.datasets[0].data.push(value);
            sandboxChart.update();
        }
    }

    const sandboxSolutions = {
        mesh: `
            <h4 class="font-semibold text-lg text-blue-700 mb-2">Mesh Analysis Solution for Sandbox Circuit</h4>
            <p><strong>Result:</strong> I_6Ω ≈ 2.273A (downwards)</p>
            <p class="text-sm mt-2"><strong>Steps Overview:</strong> Mesh currents I1 (left loop) and I2 (right loop) are assigned clockwise. KVL equations are written for each mesh, summing voltage rises/drops. The system of two linear equations is then solved for I1 and I2. Finally, the current through the 6Ω resistor (R3) is found as the algebraic difference of I1 and I2 (I1 - I2, assuming I1 acts downwards and I2 acts upwards through R3).</p>
        `,
        superposition: `
            <h4 class="font-semibold text-lg text-blue-700 mb-2">Superposition Solution for Sandbox Circuit</h4>
            <p><strong>Result:</strong> I_6Ω ≈ 2.273A (downwards)</p>
            <p class="text-sm mt-2"><strong>Steps Overview:</strong> The circuit is analyzed twice, once with the 20V source active (10V source shorted) and once with the 10V source active (20V source shorted). For each case, the current through the 6Ω resistor is calculated. The individual contributions are then algebraically summed (paying attention to direction) to get the total current. This method demonstrates how each source contributes independently to the overall response.</p>
        `,
    };
    
    sandboxBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const method = btn.dataset.method;
            sandboxSolutionEl.innerHTML = sandboxSolutions[method];
            // The value 2.273A is the correct answer for the 6Ω resistor current in the sandbox circuit
            updateSandboxChart(method.charAt(0).toUpperCase() + method.slice(1) + ' Analysis', 2.273);
        });
    });

    // Initial setup
    document.querySelector('.nav-link[data-target="techniques"]').click();
    document.querySelector('.technique-tab[data-technique="nodal"]').click();
    renderPracticeProblems();
    renderQuiz();
});
</script>
</body>
</html>
