<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mechatronics 1: Week 5 - Digital Logic Gates</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- MathJax CDN for rendering LaTeX formulas -->
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <script>
        // MathJax configuration to handle common delimiters for LaTeX formulas
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']], // Inline math using $...$ or \(...\)
                displayMath: [['$$', '$$'], ['\\[', '\\]']], // Display math using $$...$$ or \[...\]
                processEscapes: true, // Process escaped characters like \$
                processEnvironments: true, // Process LaTeX environments like \begin{align*}
                tags: 'ams' // Enable automatic equation numbering with AMS packages
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore', // Class to ignore for MathJax processing
                processHtmlClass: 'tex2jax_process' // Class to explicitly process for MathJax
            }
        };
    </script>

    <!-- Custom CSS for styling and specific component layouts -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Styling for active navigation/tab links */
        .tab-active { 
            border-color: #3b82f6; /* blue-500 */
            color: #1d4ed8; /* blue-700 */
            background-color: #eff6ff; /* blue-50 */
        }
        /* Styles for step-by-step content reveal */
        .step-content {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .step-content.visible {
            display: block;
            opacity: 1;
        }
        /* Styling for solution boxes in examples and practice problems */
        .solution-box {
            background-color: #f8fafc;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'Courier New', monospace;
            overflow-x: auto; /* Allows horizontal scrolling for long code/formulas */
        }
        /* Base button styling */
        .btn {
            background-color: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
            cursor: pointer;
        }
        .btn:hover { background-color: #2563eb; }
        /* Secondary button styling */
        .btn-secondary {
            background-color: #6b7280;
        }
        .btn-secondary:hover { background-color: #4b5563; }
        /* Utility class to hide elements */
        .hidden { display: none; }
        /* Ensure MathJax rendered elements handle overflow for long formulas */
        .katex-display { display: block; overflow-x: auto; white-space: nowrap; }

        /* Logic Gate Diagram Styling */
        .logic-gate-diagram {
            position: relative;
            background-color: #f3f4f6;
            border: 2px solid #d1d5db;
            padding: 1rem;
            border-radius: 0.5rem;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', sans-serif;
            margin-bottom: 1rem;
            box-sizing: border-box;
            overflow: hidden;
        }
        .gate-body {
            position: absolute;
            background-color: #3b82f6;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 0.25rem;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }
        .input-line, .output-line {
            position: absolute;
            background-color: #374151;
            z-index: 0;
        }
        .input-label, .output-label {
            position: absolute;
            font-size: 0.75rem;
            color: #374151;
            white-space: nowrap;
        }
        .inverter-circle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #374151;
        }
        /* Truth Table Styling */
        .truth-table-container {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-top: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            overflow: hidden;
        }
        .truth-table-container table {
            width: 100%;
            border-collapse: collapse;
        }
        .truth-table-container th, .truth-table-container td {
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            text-align: center;
        }
        .truth-table-container th {
            background-color: #e0f2fe; /* blue-50 */
            font-weight: bold;
        }
        .truth-table-container tr:nth-child(even) {
            background-color: #f9fafb; /* gray-50 */
        }

        /* Quiz specific styling */
        .quiz-option {
            background-color: #f0fdf4;
            border: 1px solid #d1fae5;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .quiz-option:hover {
            background-color: #e0fdf0;
        }
        .quiz-option.selected {
            background-color: #d1fae5;
            border-color: #10b981;
        }
        .quiz-option.correct {
            background-color: #a7f3d0; /* green-200 */
            border-color: #059669; /* green-600 */
        }
        .quiz-option.incorrect {
            background-color: #fecaca; /* red-200 */
            border-color: #ef4444; /* red-500 */
        }
        .quiz-explanation {
            background-color: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            margin-top: 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.9rem;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-10">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-bold text-blue-700">Mechatronics 1: Week 5 - Digital Logic Gates</h1>
                <div class="flex space-x-4 text-sm font-medium">
                    <button data-target="concepts" class="nav-link px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">Digital Logic Concepts</button>
                    <button data-target="sandbox" class="nav-link px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">Interactive Sandbox</button>
                    <button data-target="practice" class="nav-link px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">Practice Problems</button>
                </div>
            </div>
        </nav>
    </header>

    <main id="app-container" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Section: Digital Logic Concepts -->
        <section id="concepts" class="app-section">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-3xl font-bold mb-4 text-gray-900">Introduction to Digital Logic: The Language of Computers</h2>
                <p class="text-gray-600 mb-6">Moving from analog signals to the discrete world of digital logic, this week we explore the fundamental building blocks of all digital systems and microcontrollers found in mechatronics. Understanding these gates is crucial for grasping how decisions are made and processes are controlled in automated systems. Select a topic below to delve deeper.</p>

                <!-- Tabs for different digital logic concepts -->
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex flex-wrap" aria-label="Tabs">
                        <button class="concept-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-concept="intro_basics">Intro & Binary</button>
                        <button class="concept-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-concept="basic_gates">Basic Gates</button>
                        <button class="concept-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-concept="universal_gates">Universal Gates</button>
                        <button class="concept-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm" data-concept="exclusive_gates">Exclusive Gates</button>
                    </nav>
                </div>

                <!-- Content area where selected concept details will be injected -->
                <div id="concept-content" class="mt-6">
                    <!-- Content will be injected here by JS -->
                </div>
            </div>
        </section>

        <!-- Section: Interactive Sandbox -->
        <section id="sandbox" class="app-section hidden">
             <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-3xl font-bold mb-2 text-gray-900">Interactive Sandbox: Logic Gate Simulator</h2>
                <p class="text-gray-600 mb-6">Explore the behavior of different logic gates. Select a gate, then toggle the input switches (0 or 1) to see how the output changes and observe its corresponding truth table. This directly illustrates Boolean logic in action.</p>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Gate Selection & Inputs</h3>
                        <div class="mb-4">
                            <label for="gateSelect" class="font-medium">Select a Gate:</label>
                            <select id="gateSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                                <option value="AND">AND Gate</option>
                                <option value="OR">OR Gate</option>
                                <option value="NOT">NOT Gate</option>
                                <option value="NAND">NAND Gate</option>
                                <option value="NOR">NOR Gate</option>
                                <option value="XOR">XOR Gate</option>
                                <option value="XNOR">XNOR Gate</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-4 mb-4">
                            <span class="font-medium">Input A:</span>
                            <button id="inputA" class="btn w-16" data-value="0">0</button>
                            <span id="inputA-status" class="text-gray-700">LOW</span>
                        </div>
                        <div class="flex items-center space-x-4 mb-4" id="inputB-container">
                            <span class="font-medium">Input B:</span>
                            <button id="inputB" class="btn w-16" data-value="0">0</button>
                            <span id="inputB-status" class="text-gray-700">LOW</span>
                        </div>
                        <div class="mt-6 text-xl font-bold text-gray-900">
                            Output Q: <span id="outputQ" class="text-blue-700">0</span>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Truth Table</h3>
                        <div id="truth-table-display" class="truth-table-container">
                            <!-- Truth table will be rendered here dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: Practice Problems -->
        <section id="practice" class="app-section hidden">
            <div class="bg-white p-6 rounded-lg shadow">
                 <h2 class="text-3xl font-bold mb-4 text-gray-900">Practice Problems</h2>
                 <p class="text-gray-600 mb-6">Test your understanding with these problems from the course notes. Click "Show Answer" to reveal the detailed solution.</p>
                 <div id="practice-problems-container" class="space-y-6">
                    <!-- Practice problems will be injected here -->
                 </div>
                 <h2 class="text-3xl font-bold mt-8 mb-4 text-gray-900">Quiz</h2>
                 <p class="text-gray-600 mb-6">Challenge your knowledge with these multiple-choice questions. Select your answer and click 'Check Answer'.</p>
                 <div id="quiz-container" class="space-y-6">
                    <!-- Quiz questions will be injected here -->
                 </div>
            </div>
        </section>

    </main>
    
<script>
// Data for the application sections, including concepts, examples, and their associated HTML for diagrams
const appData = {
    intro_basics: {
        title: "Introduction to Digital Logic & Binary System",
        description: "Digital logic is the foundation of all modern computers and control systems. Unlike analog signals which are continuous, digital signals operate on discrete, typically binary, values.",
        steps: [
            "<strong>Analog vs. Digital:</strong> Analog signals are continuous (e.g., sound waves, temperature), while digital signals are discrete (e.g., ON/OFF, TRUE/FALSE, 0/1). Mechatronic systems often convert analog sensor data to digital for processing.",
            "<strong>Binary System:</strong> Digital logic uses the binary number system, which has only two digits: 0 and 1. These represent different voltage levels (e.g., 0V for '0' and 5V for '1').",
            "<strong>Logic Gates:</strong> The fundamental building blocks of digital circuits. They take one or more binary inputs and produce a single binary output based on a specific logical rule.",
            "<strong>Boolean Algebra:</strong> The mathematical system used to analyze and simplify digital circuits. It uses variables that can only be 0 or 1, and logical operations (AND, OR, NOT).",
            "<strong>Why Digital in Mechatronics?</strong> Digital systems offer higher precision, noise immunity, easier data storage, and programmability compared to purely analog systems. Microcontrollers (small computers) are digital devices at the heart of many mechatronic applications.",
            "Real-Life Application: A simple ON/OFF switch for a motor. When the switch is ON (logical 1), the motor runs. When it's OFF (logical 0), the motor stops. This is the simplest form of digital control."
        ],
        example: {
            problem: "If an analog temperature sensor outputs a voltage from 0V to 5V, how can a digital system interpret 'hot' or 'cold'?",
            // HTML structure for the example diagram, using Tailwind CSS classes for styling
            circuitHTML: `
                <div class="p-4 bg-gray-200 rounded-md text-center">
                    <p class="font-semibold mb-2">Analog Sensor to Digital Logic</p>
                    <div class="flex items-center justify-center space-x-4">
                        <div class="p-2 border border-gray-400 rounded-md">Analog Input (0-5V)</div>
                        <div class="text-2xl font-bold">&rarr;</div>
                        <div class="p-2 border border-blue-500 rounded-md bg-blue-100">Comparator</div>
                        <div class="text-2xl font-bold">&rarr;</div>
                        <div class="p-2 border border-green-500 rounded-md bg-green-100">Digital Output (0 or 1)</div>
                    </div>
                    <p class="text-sm mt-2 text-gray-600">Threshold: 2.5V</p>
                </div>
            `, 
            solutionSteps: [
                {
                    title: "Concept of Thresholding",
                    content: `A digital system would use a comparator (often an op-amp, as learned last week!) to set a threshold voltage. For instance, if the threshold is 2.5V:`
                },
                {
                    title: "Digital Output",
                    content: `If sensor voltage > 2.5V, output is '1' (Hot).<br>
                    If sensor voltage ≤ 2.5V, output is '0' (Cold).<br>
                    <div class="solution-box">This converts a continuous analog signal into a discrete digital decision.</div>`
                },
                {
                    title: "Mechatronics Context",
                    content: `This digital output (0 or 1) can then directly control a cooling fan (ON for '1', OFF for '0') or activate a warning light, demonstrating a simple mechatronic control loop.`
                }
            ]
        }
    },
    basic_gates: {
        title: "Basic Logic Gates: AND, OR, NOT",
        description: "These three gates are the fundamental building blocks from which all other digital logic functions can be derived. Each performs a unique logical operation.",
        steps: [
            "<strong>AND Gate:</strong> Output is 1 (HIGH) ONLY IF all inputs are 1 (HIGH). Otherwise, output is 0 (LOW).",
            "&bull; Boolean Expression: $Q = A \\cdot B$ (or $Q = AB$)",
            "&bull; Real-Life Example: A safety interlock on a machine where the machine operates (Output = 1) ONLY IF the safety guard is closed (Input A = 1) AND the emergency stop button is not pressed (Input B = 1).",
            "<strong>OR Gate:</strong> Output is 1 (HIGH) IF AT LEAST ONE input is 1 (HIGH). Output is 0 (LOW) ONLY IF all inputs are 0 (LOW).",
            "&bull; Boolean Expression: $Q = A + B$",
            "&bull; Real-Life Example: A security alarm (Output = 1) triggers IF the front door sensor (Input A = 1) OR the back window sensor (Input B = 1) is activated.",
            "<strong>NOT Gate (Inverter):</strong> Has only one input. The output is always the opposite of the input. If input is 1, output is 0; if input is 0, output is 1.",
            "&bull; Boolean Expression: $Q = \\bar{A}$ (or $Q = A'$)",
            "&bull; Real-Life Example: An automatic night light (Output = 1) turns on IF it is NOT (Input A = 0 for light sensor)."
        ],
        example: {
            problem: "For an AND gate with inputs A=1, B=0 and an OR gate with inputs A=1, B=0, what are their respective outputs?",
            circuitHTML: `
                <div class="flex flex-col items-center space-y-4">
                    <div class="flex items-center space-x-4">
                        <div class="flex flex-col items-end">
                            <span class="text-sm font-medium">A: 1</span>
                            <span class="text-sm font-medium">B: 0</span>
                        </div>
                        <div class="border-2 border-gray-600 p-4 rounded-lg bg-gray-100 text-center font-bold">AND Gate</div>
                        <div class="text-xl font-bold">&rarr;</div>
                        <div class="p-2 border border-gray-400 rounded-md">Q: ?</div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex flex-col items-end">
                            <span class="text-sm font-medium">A: 1</span>
                            <span class="text-sm font-medium">B: 0</span>
                        </div>
                        <div class="border-2 border-gray-600 p-4 rounded-lg bg-gray-100 text-center font-bold">OR Gate</div>
                        <div class="text-xl font-bold">&rarr;</div>
                        <div class="p-2 border border-gray-400 rounded-md">Q: ?</div>
                    </div>
                </div>
            `,
            solutionSteps: [
                {
                    title: "Step 1: AND Gate Output",
                    content: `For an AND gate, the output is 1 ONLY IF both inputs are 1. Since Input B is 0, the output is 0.<br>
                    <div class="solution-box">AND Gate Output: <strong>0</strong></div>`
                },
                {
                    title: "Step 2: OR Gate Output",
                    content: `For an OR gate, the output is 1 IF AT LEAST ONE input is 1. Since Input A is 1, the output is 1.<br>
                    <div class="solution-box">OR Gate Output: <strong>1</strong></div>`
                },
                {
                    title: "Final Answer",
                    content: `<div class="p-4 bg-green-100 text-green-800 rounded-lg">AND Gate Output: <strong>0</strong> <br> OR Gate Output: <strong>1</strong> </div>`
                }
            ]
        }
    },
    universal_gates: {
        title: "Universal Gates: NAND and NOR",
        description: "NAND and NOR gates are 'universal' because any other logic gate (AND, OR, NOT, XOR, XNOR) can be constructed solely using one type of universal gate. This simplifies integrated circuit design.",
        steps: [
            "<strong>NAND Gate:</strong> NOT AND. Output is 0 (LOW) ONLY IF all inputs are 1 (HIGH). Otherwise, output is 1 (HIGH). It's the inverse of an AND gate.",
            "&bull; Boolean Expression: $Q = \\overline{A \\cdot B}$ (or $Q = \\overline{AB}$)",
            "&bull; Advantage: NAND gates are easier to fabricate in many transistor technologies, making them cost-effective.",
            "<strong>NOR Gate:</strong> NOT OR. Output is 1 (HIGH) ONLY IF all inputs are 0 (LOW). Otherwise, output is 0 (LOW). It's the inverse of an OR gate.",
            "&bull; Boolean Expression: $Q = \\overline{A + B}$",
            "&bull; Advantage: Like NAND, NOR gates are fundamental in CMOS and other logic families.",
            "Real-Life Application: In microcontrollers, universal gates reduce the number of different gate types needed on a chip, simplifying manufacturing and reducing cost. For example, a system designed with only NAND gates requires less complex fabrication processes than one requiring AND, OR, and NOT gates separately."
        ],
        example: {
            problem: "If a NAND gate has inputs A=1, B=1 and a NOR gate has inputs A=0, B=0, what are their respective outputs?",
            circuitHTML: `
                <div class="flex flex-col items-center space-y-4">
                    <div class="flex items-center space-x-4">
                        <div class="flex flex-col items-end">
                            <span class="text-sm font-medium">A: 1</span>
                            <span class="text-sm font-medium">B: 1</span>
                        </div>
                        <div class="border-2 border-gray-600 p-4 rounded-lg bg-gray-100 text-center font-bold">NAND Gate</div>
                        <div class="text-xl font-bold">&rarr;</div>
                        <div class="p-2 border border-gray-400 rounded-md">Q: ?</div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex flex-col items-end">
                            <span class="text-sm font-medium">A: 0</span>
                            <span class="text-sm font-medium">B: 0</span>
                        </div>
                        <div class="border-2 border-gray-600 p-4 rounded-lg bg-gray-100 text-center font-bold">NOR Gate</div>
                        <div class="text-xl font-bold">&rarr;</div>
                        <div class="p-2 border border-gray-400 rounded-md">Q: ?</div>
                    </div>
                </div>
            `,
            solutionSteps: [
                {
                    title: "Step 1: NAND Gate Output",
                    content: `For a NAND gate, output is 0 ONLY IF both inputs are 1. Here, A=1 and B=1, so output is 0.<br>
                    <div class="solution-box">NAND Gate Output: <strong>0</strong></div>`
                },
                {
                    title: "Step 2: NOR Gate Output",
                    content: `For a NOR gate, output is 1 ONLY IF both inputs are 0. Here, A=0 and B=0, so output is 1.<br>
                    <div class="solution-box">NOR Gate Output: <strong>1</strong></div>`
                },
                {
                    title: "Final Answer",
                    content: `<div class="p-4 bg-green-100 text-green-800 rounded-lg">NAND Gate Output: <strong>0</strong> <br> NOR Gate Output: <strong>1</strong> </div>`
                }
            ]
        }
    },
    exclusive_gates: {
        title: "Exclusive Gates: XOR and XNOR",
        description: "Exclusive OR (XOR) and Exclusive NOR (XNOR) gates are special gates used in operations like parity checking, arithmetic circuits (adders), and data encryption/decryption due to their unique behavior.",
        steps: [
            "<strong>XOR Gate (Exclusive OR):</strong> Output is 1 (HIGH) IF an ODD number of inputs are 1 (HIGH). If both inputs are the same (0,0 or 1,1), output is 0.",
            "&bull; Boolean Expression: $Q = A \\oplus B$",
            "&bull; Real-Life Example: A simple light switch circuit (Output = Light ON) where there are two switches. Toggling either switch (A or B) flips the light state (ON/OFF). If both switches are in the same position (both UP or both DOWN), the light is OFF.",
            "<strong>XNOR Gate (Exclusive NOR):</strong> NOT XOR. Output is 1 (HIGH) IF an EVEN number of inputs are 1 (HIGH) (i.e., both inputs are the same: 0,0 or 1,1). It's the inverse of an XOR gate.",
            "&bull; Boolean Expression: $Q = \\overline{A \\oplus B}$",
            "&bull; Real-Life Application: Used in digital comparators to check if two binary inputs are identical. If A and B are the same, the output is 1."
        ],
        example: {
            problem: "For an XOR gate with inputs A=1, B=1 and an XNOR gate with inputs A=0, B=1, what are their respective outputs?",
            circuitHTML: `
                <div class="flex flex-col items-center space-y-4">
                    <div class="flex items-center space-x-4">
                        <div class="flex flex-col items-end">
                            <span class="text-sm font-medium">A: 1</span>
                            <span class="text-sm font-medium">B: 1</span>
                        </div>
                        <div class="border-2 border-gray-600 p-4 rounded-lg bg-gray-100 text-center font-bold">XOR Gate</div>
                        <div class="text-xl font-bold">&rarr;</div>
                        <div class="p-2 border border-gray-400 rounded-md">Q: ?</div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex flex-col items-end">
                            <span class="text-sm font-medium">A: 0</span>
                            <span class="text-sm font-medium">B: 1</span>
                        </div>
                        <div class="border-2 border-gray-600 p-4 rounded-lg bg-gray-100 text-center font-bold">XNOR Gate</div>
                        <div class="text-xl font-bold">&rarr;</div>
                        <div class="p-2 border border-gray-400 rounded-md">Q: ?</div>
                    </div>
                </div>
            `,
            solutionSteps: [
                {
                    title: "Step 1: XOR Gate Output",
                    content: `For an XOR gate, output is 0 if inputs are the same. Here, A=1 and B=1, so output is 0.<br>
                    <div class="solution-box">XOR Gate Output: <strong>0</strong></div>`
                },
                {
                    title: "Step 2: XNOR Gate Output",
                    content: `For an XNOR gate, output is 0 if inputs are different. Here, A=0 and B=1, so output is 0.<br>
                    <div class="solution-box">XNOR Gate Output: <strong>0</strong></div>`
                },
                {
                    title: "Final Answer",
                    content: `<div class="p-4 bg-green-100 text-green-800 rounded-lg">XOR Gate Output: <strong>0</strong> <br> XNOR Gate Output: <strong>0</strong> </div>`
                }
            ]
        }
    }
};

const practiceProblems = [
    {
        id: 1,
        title: "Basic Gate Output",
        problemHTML: `An OR gate has inputs A=0 and B=1. What is the output Q?`,
        answerHTML: `<b>Solution:</b><br>
        For an OR gate, the output is 1 if at least one input is 1. Here, B=1, so the output is 1.<br>
        <div class="solution-box">Output Q = <strong>1</strong></div>`
    },
    {
        id: 2,
        title: "NOT Gate Application",
        problemHTML: `If a NOT gate (inverter) has an input of 1, what is its output?`,
        answerHTML: `<b>Solution:</b><br>
        A NOT gate inverts its input. If the input is 1, the output is 0.<br>
        <div class="solution-box">Output Q = <strong>0</strong></div>`
    },
    {
        id: 3,
        title: "NAND Gate Calculation",
        problemHTML: `A NAND gate has inputs A=1 and B=0. What is the output Q?`,
        answerHTML: `<b>Solution:</b><br>
        A NAND gate is the inverse of an AND gate. An AND gate with A=1, B=0 would output 0. Therefore, the NAND gate outputs 1.<br>
        <div class="solution-box">Output Q = <strong>1</strong></div>`
    },
    {
        id: 4,
        title: "XOR Gate Truth Table",
        problemHTML: `Which of the following input combinations will result in an output of 1 for an XOR gate?<br>
        a) A=0, B=0 <br>
        b) A=0, B=1 <br>
        c) A=1, B=1`,
        answerHTML: `<b>Solution:</b><br>
        An XOR gate outputs 1 only when its inputs are different.<br>
        a) A=0, B=0 $\\rightarrow$ Output = 0<br>
        b) A=0, B=1 $\\rightarrow$ Output = 1<br>
        c) A=1, B=1 $\\rightarrow$ Output = 0<br>
        <div class="solution-box">The correct option is <strong>b) A=0, B=1</strong></div>`
    }
];

const quizQuestions = [
    {
        id: 1,
        question: "Which logic gate's output is HIGH only if all inputs are HIGH?",
        options: ["OR", "NOT", "AND", "XOR"],
        answer: "AND",
        explanation: "The AND gate requires all inputs to be HIGH (1) for its output to be HIGH (1)."
    },
    {
        id: 2,
        question: "What is the Boolean expression for a NOT gate?",
        options: ["A + B", "A \\cdot B", "\\bar{A}", "A \\oplus B"],
        answer: "\\bar{A}",
        explanation: "The NOT gate (inverter) negates its single input, represented by a bar over the variable ($\\bar{A}$).",
    },
    {
        id: 3,
        question: "Which of the following gates is considered a 'universal' gate?",
        options: ["AND", "XOR", "NOR", "OR"],
        answer: "NOR",
        explanation: "NAND and NOR gates are universal gates because any other logic function can be implemented using only them."
    },
    {
        id: 4,
        question: "If an XNOR gate has inputs A=0 and B=0, what is the output?",
        options: ["0", "1", "Undefined", "Error"],
        answer: "1",
        explanation: "An XNOR gate outputs HIGH (1) if both inputs are the same. Since A=0 and B=0, they are the same, resulting in an output of 1."
    },
    {
        id: 5,
        question: "In digital logic, what do '0' and '1' typically represent?",
        options: ["TRUE/FALSE", "LOW/HIGH voltage", "OFF/ON", "All of the above"],
        answer: "All of the above",
        explanation: "'0' and '1' are binary digits representing discrete states like TRUE/FALSE, LOW/HIGH voltage levels, or OFF/ON states in digital systems."
    }
];


document.addEventListener('DOMContentLoaded', () => {
    const navLinks = document.querySelectorAll('.nav-link');
    const appSections = document.querySelectorAll('.app-section');
    const conceptTabs = document.querySelectorAll('.concept-tab');
    const conceptContent = document.getElementById('concept-content');
    const practiceProblemsContainer = document.getElementById('practice-problems-container');
    const quizContainer = document.getElementById('quiz-container');

    // Sandbox specific elements (ensure these are correctly identified from the HTML)
    const gateSelect = document.getElementById('gateSelect');
    const inputA = document.getElementById('inputA');
    const inputB = document.getElementById('inputB');
    const inputAStatus = document.getElementById('inputA-status');
    const inputBStatus = document.getElementById('inputB-status');
    const outputQ = document.getElementById('outputQ');
    const inputBContainer = document.getElementById('inputB-container');
    const truthTableDisplay = document.getElementById('truth-table-display');


    // --- MathJax Helper Function ---
    // Function to safely typeset MathJax within an element
    function typesetMath(element) {
        if (window.MathJax && element) { // Check if MathJax is loaded and element exists
            // Clear previous MathJax rendering within the element before re-typesetting
            // This is crucial when content is dynamically replaced via innerHTML to prevent reference issues.
            window.MathJax.typesetClear([element]);
            // Typeset the content within the specified element (pass element as an array for typesetPromise)
            window.MathJax.typesetPromise([element]).then(() => {
                // console.log('MathJax typeset complete for:', element.id || element.className || element.tagName);
            }).catch(err => console.error('MathJax typesetting failed:', err));
        }
    }


    // --- Main Navigation Logic ---
    function showSection(sectionId) {
        appSections.forEach(section => {
            section.classList.add('hidden');
        });
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
            targetSection.classList.remove('hidden');
            // Typeset content of the newly visible section
            typesetMath(targetSection); 
        }

        navLinks.forEach(link => {
            link.classList.remove('tab-active', 'font-bold', 'text-blue-700');
        });
        document.querySelector(`.nav-link[data-target="${sectionId}"]`).classList.add('tab-active', 'font-bold', 'text-blue-700');

        // Initialize sandbox on first visit to ensure truth table is populated
        if (sectionId === 'sandbox') {
            updateGateSimulator();
        }
    }

    navLinks.forEach(link => {
        link.addEventListener('click', () => {
            showSection(link.dataset.target);
        });
    });

    // --- Concept Tabs Logic ---
    function loadConceptContent(conceptKey) {
        const data = appData[conceptKey];
        if (!data) return;

        let html = `
            <h3 class="text-2xl font-semibold mb-4 text-blue-800">${data.title}</h3>
            <p class="mb-4">${data.description}</p>
            <h4 class="text-xl font-semibold mb-3">Key Concepts:</h4>
            <ul class="list-disc list-inside ml-4 mb-6 space-y-2">
        `;
        data.steps.forEach(step => {
            html += `<li class="mb-1">${step}</li>`;
        });
        html += `</ul>`;

        if (data.example) {
            html += `
                <h4 class="text-xl font-semibold mb-3">Worked Example:</h4>
                <div class="bg-gray-100 p-4 rounded-lg">
                    <p class="font-medium mb-2">${data.example.problem}</p>
                    ${data.example.circuitHTML ? `<div class="mb-4">${data.example.circuitHTML}</div>` : ''}
                    <button class="btn show-solution-btn">Show Solution Steps</button>
                    <div class="solution-steps mt-4 hidden">
            `;
            data.example.solutionSteps.forEach((step, index) => {
                html += `
                    <div class="step-card bg-white p-3 rounded-md shadow-sm mb-3 border border-gray-200">
                        <h5 class="font-semibold text-gray-800">Step ${index + 1}: ${step.title}</h5>
                        <div class="step-content mt-1 text-gray-700">
                            ${step.content}
                        </div>
                        <button class="btn btn-secondary show-step-btn mt-2">Show Step</button>
                    </div>
                `;
            });
            html += `</div></div>`;
        }
        
        conceptContent.innerHTML = html;

        // Add event listeners for solution steps
        conceptContent.querySelectorAll('.show-solution-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const solutionStepsDiv = e.target.nextElementSibling;
                solutionStepsDiv.classList.toggle('hidden');
                e.target.textContent = solutionStepsDiv.classList.contains('hidden') ? 'Show Solution Steps' : 'Hide Solution Steps';
                if (!solutionStepsDiv.classList.contains('hidden')) { // Only typeset when showing
                    typesetMath(solutionStepsDiv);
                } else {
                    if (window.MathJax) window.MathJax.typesetClear([solutionStepsDiv]);
                }
            });
        });

        conceptContent.querySelectorAll('.show-step-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const stepContentDiv = e.target.previousElementSibling;
                stepContentDiv.classList.toggle('visible');
                e.target.textContent = stepContentDiv.classList.contains('visible') ? 'Hide Step' : 'Show Step';
                if (stepContentDiv.classList.contains('visible')) { // Only typeset when showing
                    typesetMath(stepContentDiv);
                } else {
                    if (window.MathJax) window.MathJax.typesetClear([stepContentDiv]);
                }
            });
        });

        // Initial typeset for the newly loaded concept content
        typesetMath(conceptContent);
    }

    conceptTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            conceptTabs.forEach(t => {
                t.classList.remove('tab-active', 'font-bold', 'text-blue-700');
                t.classList.add('text-gray-700', 'hover:bg-gray-100');
            });
            tab.classList.add('tab-active', 'font-bold', 'text-blue-700');
            tab.classList.remove('text-gray-700', 'hover:bg-gray-100');
            loadConceptContent(tab.dataset.concept);
        });
    });

    // --- Practice Problems Logic ---
    function loadPracticeProblems() {
        let html = '';
        practiceProblems.forEach(problem => {
            html += `
                <div class="bg-gray-100 p-4 rounded-lg shadow-sm border border-gray-200">
                    <h3 class="text-xl font-semibold mb-2">Problem ${problem.id}: ${problem.title}</h3>
                    <p class="mb-4">${problem.problemHTML}</p>
                    <button class="btn show-answer-btn">Show Answer</button>
                    <div class="answer-box mt-4 hidden">
                        ${problem.answerHTML}
                    </div>
                </div>
            `;
        });
        practiceProblemsContainer.innerHTML = html;

        practiceProblemsContainer.querySelectorAll('.show-answer-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const answerBox = e.target.nextElementSibling;
                answerBox.classList.toggle('hidden');
                e.target.textContent = answerBox.classList.contains('hidden') ? 'Show Answer' : 'Hide Answer';
                if (!answerBox.classList.contains('hidden')) { // Only typeset when showing
                    typesetMath(answerBox);
                } else {
                    if (window.MathJax) window.MathJax.typesetClear([answerBox]);
                }
            });
        });
        // Initial typeset for the entire loaded practice problems container
        typesetMath(practiceProblemsContainer);
    }

    // --- Quiz Logic ---
    function loadQuiz() {
        let html = '';
        quizQuestions.forEach((q, index) => {
            html += `
                <div class="bg-gray-100 p-4 rounded-lg shadow-sm border border-gray-200" data-question-id="${q.id}">
                    <h3 class="text-xl font-semibold mb-3">Question ${index + 1}: ${q.question}</h3>
                    <div class="options-container space-y-2">
            `;
            q.options.forEach((option, optIndex) => {
                html += `
                        <div class="quiz-option" data-option="${option}">
                            ${String.fromCharCode(97 + optIndex)}. ${option}
                        </div>
                `;
            });
            html += `
                    </div>
                    <button class="btn check-answer-btn mt-4">Check Answer</button>
                    <div class="quiz-explanation mt-4 hidden">
                        <strong>Explanation:</strong> ${q.explanation}
                    </div>
                </div>
            `;
        });
        quizContainer.innerHTML = html;

        quizContainer.querySelectorAll('.quiz-option').forEach(optionDiv => {
            optionDiv.addEventListener('click', (e) => {
                const parentQuestion = e.target.closest('.bg-gray-100');
                parentQuestion.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                });
                e.target.classList.add('selected');
            });
        });

        quizContainer.querySelectorAll('.check-answer-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const parentQuestion = e.target.closest('.bg-gray-100');
                const selectedOption = parentQuestion.querySelector('.quiz-option.selected');
                const explanationBox = parentQuestion.querySelector('.quiz-explanation');
                
                if (!selectedOption) {
                    // In a real app, use a custom modal for user feedback instead of alert()
                    // console.log('Please select an option first!');
                    return;
                }

                const questionId = parseInt(parentQuestion.dataset.questionId);
                const quizQ = quizQuestions.find(q => q.id === questionId);

                if (selectedOption.dataset.option === quizQ.answer) {
                    selectedOption.classList.remove('selected');
                    selectedOption.classList.add('correct');
                    // console.log('Correct!');
                } else {
                    selectedOption.classList.remove('selected');
                    selectedOption.classList.add('incorrect');
                    // Find and highlight the correct answer
                    parentQuestion.querySelectorAll('.quiz-option').forEach(opt => {
                        if (opt.dataset.option === quizQ.answer) {
                            opt.classList.add('correct');
                        }
                    });
                    // console.log('Incorrect. Try again!');
                }
                explanationBox.classList.remove('hidden');
                typesetMath(explanationBox); // Typeset explanation content
            });
        });
        // Initial typeset for quiz problems
        typesetMath(quizContainer);
    }

    // --- Interactive Sandbox Gate Simulator Logic ---

    // Define logic for each gate based on binary inputs
    const gateLogic = {
        AND: (a, b) => a && b,
        OR: (a, b) => a || b,
        NOT: (a) => !a, // NOT only has one input
        NAND: (a, b) => !(a && b),
        NOR: (a, b) => !(a || b),
        XOR: (a, b) => (a !== b),
        XNOR: (a, b) => (a === b)
    };

    // Define truth tables for each gate
    const truthTableData = {
        AND: {
            headers: ["A", "B", "Q"],
            data: [
                [0, 0, 0],
                [0, 1, 0],
                [1, 0, 0],
                [1, 1, 1]
            ]
        },
        OR: {
            headers: ["A", "B", "Q"],
            data: [
                [0, 0, 0],
                [0, 1, 1],
                [1, 0, 1],
                [1, 1, 1]
            ]
        },
        NOT: {
            headers: ["A", "Q"],
            data: [
                [0, 1],
                [1, 0]
            ]
        },
        NAND: {
            headers: ["A", "B", "Q"],
            data: [
                [0, 0, 1],
                [0, 1, 1],
                [1, 0, 1],
                [1, 1, 0]
            ]
        },
        NOR: {
            headers: ["A", "B", "Q"],
            data: [
                [0, 0, 1],
                [0, 1, 0],
                [1, 0, 0],
                [1, 1, 0]
            ]
        },
        XOR: {
            headers: ["A", "B", "Q"],
            data: [
                [0, 0, 0],
                [0, 1, 1],
                [1, 0, 1],
                [1, 1, 0]
            ]
        },
        XNOR: {
            headers: ["A", "B", "Q"],
            data: [
                [0, 0, 1],
                [0, 1, 0],
                [1, 0, 0],
                [1, 1, 1]
            ]
        }
    };

    // Function to update the gate simulator's output and truth table
    function updateGateSimulator() {
        const selectedGate = gateSelect.value;
        // Parse current input values from data-value attributes
        let inputAValue = parseInt(inputA.dataset.value);
        let inputBValue = parseInt(inputB.dataset.value);

        let currentOutput;
        let tt; // Variable to hold the truth table data for the selected gate

        // Adjust visibility of Input B based on selected gate (NOT gate has only one input)
        if (selectedGate === 'NOT') {
            inputBContainer.classList.add('hidden');
            inputBValue = undefined; // Set B to undefined for NOT gate logic
            currentOutput = gateLogic[selectedGate](inputAValue); // Calculate output for NOT gate
            tt = truthTableData[selectedGate]; // Get truth table for NOT gate
        } else {
            inputBContainer.classList.remove('hidden'); // Show Input B for other gates
            currentOutput = gateLogic[selectedGate](inputAValue, inputBValue); // Calculate output for two-input gates
            tt = truthTableData[selectedGate]; // Get truth table for two-input gates
        }

        // Display the calculated output (convert boolean result to '1' or '0')
        outputQ.textContent = currentOutput ? '1' : '0';

        // Dynamically build and update the truth table HTML
        let tableHTML = `<table><thead><tr>`;
        tt.headers.forEach(header => {
            tableHTML += `<th>${header}</th>`;
        });
        tableHTML += `</tr></thead><tbody>`;

        tt.data.forEach(row => {
            tableHTML += `<tr>`;
            row.forEach(cell => {
                tableHTML += `<td>${cell}</td>`;
            });
            tableHTML += `</tr>`;
        });
        tableHTML += `</tbody></table>`;
        truthTableDisplay.innerHTML = tableHTML;
    }

    // Function to toggle input button values (0 <-> 1)
    function toggleInput(button, statusSpan) {
        let currentValue = parseInt(button.dataset.value);
        let newValue = 1 - currentValue; // Toggle 0 to 1, 1 to 0
        button.dataset.value = newValue; // Update data-value attribute
        button.textContent = newValue; // Update button text
        statusSpan.textContent = newValue === 1 ? 'HIGH' : 'LOW'; // Update status text
        updateGateSimulator(); // Recalculate and update simulator after input change
    }

    // Event Listeners for Sandbox interactions
    inputA.addEventListener('click', () => toggleInput(inputA, inputAStatus));
    inputB.addEventListener('click', () => toggleInput(inputB, inputBStatus));
    gateSelect.addEventListener('change', updateGateSimulator); // Update simulator when gate selection changes


    // Initial setup: show 'Digital Logic Concepts' section and its 'Intro & Binary' tab
    showSection('concepts');
    loadConceptContent('intro_basics');
    conceptTabs[0].classList.add('tab-active', 'font-bold', 'text-blue-700');

    // Load practice problems and quiz content when the document is ready
    loadPracticeProblems();
    loadQuiz();
});
</script>

</body>
</html>